{"ast":null,"code":"import _classCallCheck from \"/root/GraduateProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/root/GraduateProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/root/GraduateProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/root/GraduateProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"/root/GraduateProject/src/components/Refresh/Refresh.tsx\";\nimport * as React from 'react';\nimport { connect } from 'react-redux';\nimport { refreshIntervalSelector } from '../../store/Selectors'; // import { config } from '../../config';\n\nimport { UserSettingsActions } from '../../actions/UserSettingsActions';\n// import { ToolbarDropdown } from '../ToolbarDropdown/ToolbarDropdown';\nimport RefreshButtonContainer from './RefreshButton';\nimport { GlobalActions } from '../../actions/GlobalActions';\nimport { HistoryManager, URLParam } from 'app/History';\n\n// const REFRESH_INTERVALS = config.toolbar.refreshInterval;\nvar Refresh = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(Refresh, _React$PureComponent);\n\n  var _super = _createSuper(Refresh);\n\n  function Refresh(props) {\n    var _this;\n\n    _classCallCheck(this, Refresh);\n\n    _this = _super.call(this, props); // Let URL override current redux state at construction time\n\n    _this.updateRefresher = function () {\n      if (_this.state.refresherRef) {\n        clearInterval(_this.state.refresherRef);\n      }\n\n      var refresherRef = undefined;\n\n      if (_this.props.refreshInterval > 0) {\n        refresherRef = window.setInterval(_this.handleRefresh, _this.props.refreshInterval);\n\n        _this.setState({\n          refresherRef: refresherRef\n        });\n      }\n    };\n\n    _this.updateRefreshInterval = function (refreshInterval) {\n      _this.props.setRefreshInterval(refreshInterval); // notify redux of the change\n\n    };\n\n    _this.handleRefresh = function () {\n      _this.props.setLastRefreshAt(Date.now()); // Components may connect to the lastRefreshAt property instead to pass a refreshMethod\n\n\n      if (_this.props.handleRefresh) {\n        _this.props.handleRefresh();\n      }\n    };\n\n    if (props.manageURL) {\n      var _refreshInterval = HistoryManager.getNumericParam(URLParam.REFRESH_INTERVAL);\n\n      if (_refreshInterval === undefined) {\n        _refreshInterval = props.refreshInterval;\n      }\n\n      if (_refreshInterval !== props.refreshInterval) {\n        props.setRefreshInterval(_refreshInterval);\n      }\n\n      HistoryManager.setParam(URLParam.REFRESH_INTERVAL, String(_refreshInterval));\n    }\n\n    _this.state = {\n      refresherRef: undefined\n    };\n    return _this;\n  }\n\n  _createClass(Refresh, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.updateRefresher();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      // ensure redux state and URL are aligned\n      if (this.props.manageURL) {\n        HistoryManager.setParam(URLParam.REFRESH_INTERVAL, String(this.props.refreshInterval));\n      }\n\n      if (prevProps.refreshInterval !== this.props.refreshInterval) {\n        this.updateRefresher();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (this.state.refresherRef) {\n        clearInterval(this.state.refresherRef);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (this.props.refreshInterval !== undefined) {\n        var hideLabel = this.props.hideLabel;\n        return /*#__PURE__*/React.createElement(React.Fragment, null, !hideLabel && /*#__PURE__*/React.createElement(\"label\", {\n          style: {\n            paddingRight: '0.5em',\n            marginLeft: '1.5em'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 84,\n            columnNumber: 26\n          }\n        }, \"Refreshing\"), /*#__PURE__*/React.createElement(RefreshButtonContainer, {\n          handleRefresh: this.handleRefresh,\n          disabled: this.props.disabled,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 11\n          }\n        }));\n      } else {\n        return /*#__PURE__*/React.createElement(RefreshButtonContainer, {\n          handleRefresh: this.handleRefresh,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 14\n          }\n        });\n      }\n    }\n  }]);\n\n  return Refresh;\n}(React.PureComponent);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    refreshInterval: refreshIntervalSelector(state)\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    setRefreshInterval: function setRefreshInterval(refresh) {\n      dispatch(UserSettingsActions.setRefreshInterval(refresh));\n    },\n    setLastRefreshAt: function setLastRefreshAt(lastRefreshAt) {\n      dispatch(GlobalActions.setLastRefreshAt(lastRefreshAt));\n    }\n  };\n};\n\nvar RefreshContainer = connect(mapStateToProps, mapDispatchToProps)(Refresh);\nexport default RefreshContainer;","map":{"version":3,"sources":["/root/GraduateProject/src/components/Refresh/Refresh.tsx"],"names":["React","connect","refreshIntervalSelector","UserSettingsActions","RefreshButtonContainer","GlobalActions","HistoryManager","URLParam","Refresh","props","updateRefresher","state","refresherRef","clearInterval","undefined","refreshInterval","window","setInterval","handleRefresh","setState","updateRefreshInterval","setRefreshInterval","setLastRefreshAt","Date","now","manageURL","getNumericParam","REFRESH_INTERVAL","setParam","String","prevProps","hideLabel","paddingRight","marginLeft","disabled","PureComponent","mapStateToProps","mapDispatchToProps","dispatch","refresh","lastRefreshAt","RefreshContainer"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { connect } from 'react-redux';\nimport { ThunkDispatch } from 'redux-thunk';\nimport { KialiAppState } from '../../store/Store';\nimport { refreshIntervalSelector } from '../../store/Selectors';\n// import { config } from '../../config';\nimport { IntervalInMilliseconds, TimeInMilliseconds } from '../../types/Common';\nimport { UserSettingsActions } from '../../actions/UserSettingsActions';\nimport { KialiAppAction } from '../../actions/KialiAppAction';\n// import { ToolbarDropdown } from '../ToolbarDropdown/ToolbarDropdown';\nimport RefreshButtonContainer from './RefreshButton';\nimport { GlobalActions } from '../../actions/GlobalActions';\nimport { HistoryManager, URLParam } from 'app/History';\n\ntype ReduxProps = {\n  refreshInterval: IntervalInMilliseconds;\n  setRefreshInterval: (refreshInterval: IntervalInMilliseconds) => void;\n  setLastRefreshAt: (lastRefreshAt: TimeInMilliseconds) => void;\n};\n\ntype ComponentProps = {\n  id: string;\n  disabled?: boolean;\n  hideLabel?: boolean;\n  manageURL?: boolean;\n\n  handleRefresh?: () => void;\n};\n\ntype Props = ComponentProps & ReduxProps;\n\ntype State = {\n  refresherRef?: number;\n};\n\n// const REFRESH_INTERVALS = config.toolbar.refreshInterval;\n\nclass Refresh extends React.PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    // Let URL override current redux state at construction time\n    if (props.manageURL) {\n      let refreshInterval = HistoryManager.getNumericParam(URLParam.REFRESH_INTERVAL);\n      if (refreshInterval === undefined) {\n        refreshInterval = props.refreshInterval;\n      }\n      if (refreshInterval !== props.refreshInterval) {\n        props.setRefreshInterval(refreshInterval);\n      }\n      HistoryManager.setParam(URLParam.REFRESH_INTERVAL, String(refreshInterval));\n    }\n\n    this.state = {\n      refresherRef: undefined\n    };\n  }\n\n  componentDidMount() {\n    this.updateRefresher();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    // ensure redux state and URL are aligned\n    if (this.props.manageURL) {\n      HistoryManager.setParam(URLParam.REFRESH_INTERVAL, String(this.props.refreshInterval));\n    }\n    if (prevProps.refreshInterval !== this.props.refreshInterval) {\n      this.updateRefresher();\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.state.refresherRef) {\n      clearInterval(this.state.refresherRef);\n    }\n  }\n\n  render() {\n    if (this.props.refreshInterval !== undefined) {\n      const { hideLabel } = this.props;\n      return (\n        <>\n          {!hideLabel && <label style={{ paddingRight: '0.5em', marginLeft: '1.5em' }}>Refreshing</label>}\n          {/* <ToolbarDropdown\n            id={this.props.id}\n            handleSelect={value => this.updateRefreshInterval(Number(value))}\n            value={String(this.props.refreshInterval)}\n            label={REFRESH_INTERVALS[this.props.refreshInterval]}\n            options={REFRESH_INTERVALS}\n            tooltip={'Refresh interval'}\n            tooltipBottom={true}\n          /> */}\n          <RefreshButtonContainer handleRefresh={this.handleRefresh} disabled={this.props.disabled} />\n        </>\n      );\n    } else {\n      return <RefreshButtonContainer handleRefresh={this.handleRefresh} />;\n    }\n  }\n\n  private updateRefresher = () => {\n    if (this.state.refresherRef) {\n      clearInterval(this.state.refresherRef);\n    }\n    let refresherRef: number | undefined = undefined;\n    if (this.props.refreshInterval > 0) {\n      refresherRef = window.setInterval(this.handleRefresh, this.props.refreshInterval);\n      this.setState({ refresherRef: refresherRef });\n    }\n  };\n\n  private updateRefreshInterval = (refreshInterval: IntervalInMilliseconds) => {\n    this.props.setRefreshInterval(refreshInterval); // notify redux of the change\n  };\n\n  private handleRefresh = () => {\n    this.props.setLastRefreshAt(Date.now());\n    // Components may connect to the lastRefreshAt property instead to pass a refreshMethod\n    if (this.props.handleRefresh) {\n      this.props.handleRefresh();\n    }\n  };\n}\n\nconst mapStateToProps = (state: KialiAppState) => ({\n  refreshInterval: refreshIntervalSelector(state)\n});\n\nconst mapDispatchToProps = (dispatch: ThunkDispatch<KialiAppState, void, KialiAppAction>) => {\n  return {\n    setRefreshInterval: (refresh: IntervalInMilliseconds) => {\n      dispatch(UserSettingsActions.setRefreshInterval(refresh));\n    },\n    setLastRefreshAt: (lastRefreshAt: TimeInMilliseconds) => {\n      dispatch(GlobalActions.setLastRefreshAt(lastRefreshAt));\n    }\n  };\n};\n\nconst RefreshContainer = connect(mapStateToProps, mapDispatchToProps)(Refresh);\n\nexport default RefreshContainer;\n"]},"metadata":{},"sourceType":"module"}