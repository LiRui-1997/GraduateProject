{"ast":null,"code":"import _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport Ticker from './ticker';\nimport Element from './animateElement';\nimport { dataToArray, getAnimatePos } from '../utils';\n\nvar AnimateGroup = /*#__PURE__*/_createClass(function AnimateGroup(_props) {\n  var _this = this;\n\n  _classCallCheck(this, AnimateGroup);\n\n  this.props = void 0;\n  this.id = void 0;\n  this.children = [];\n  this.totalTime = 0;\n  this.totalTimeRegion = 0;\n  this.childTotalTime = 0;\n  this.childRegionTotalTime = 0;\n  this.prevMoment = void 0;\n  this.progressTime = 0;\n  this.progressMoment = -1;\n  this.startMoment = 0;\n  this.startTime = 0;\n  this.repeatNum = 0;\n  this.mode = 'onTimelineStart';\n  this.pausedState = void 0;\n  this.reverseState = void 0;\n  this.root = void 0;\n  this.parent = void 0;\n  this.regionStartTime = 0;\n  this.regionEndTime = void 0;\n  this.onChangeChild = void 0;\n  this.onChangeTimeline = void 0;\n\n  this.init = function () {\n    var _this$props = _this.props,\n        reverse = _this$props.reverse,\n        animation = _this$props.animation,\n        moment = _this$props.moment;\n    var animateArray = dataToArray(animation);\n\n    for (var i = 0; i < animateArray.length; i++) {\n      var item = animateArray[i];\n\n      if (item.type === 'set') {\n        item.duration = 0;\n      } //animateArray.forEach((item: any, i: number) => {\n\n\n      var animate = new Element(item);\n      animate.index = i;\n      var pos = i ? getAnimatePos(item, animateArray[i - 1]) : 0;\n      item.appearTo = pos;\n      animate.appearTo = pos;\n\n      _this.addChild(animate); //});\n\n    } // 注册\n\n\n    _this.render({\n      time: (reverse ? _this.totalTime : 0) + _this.startTime,\n      elapsed: 16.67\n    });\n\n    if (!_this.totalTime) {\n      _this.render({\n        time: (reverse ? _this.totalTime : 0) + _this.startTime,\n        elapsed: 16.67\n      });\n    }\n\n    if (moment) {\n      _this.goto(moment);\n    } else {\n      _this.play();\n    }\n  };\n\n  this.addChild = function (animate) {\n    animate.parent = _this;\n    animate.root = _this.root;\n\n    if (_this.children.indexOf(animate) === -1) {\n      _this.children.push(animate);\n\n      _this.setTotalTime();\n    }\n  };\n\n  this.setTotalTime = function () {\n    _this.childTotalTime = 0;\n    _this.childRegionTotalTime = 0;\n\n    for (var i = 0; i < _this.children.length; i++) {\n      var item = _this.children[i];\n\n      if (item.appearTo !== _this.childTotalTime) {\n        var itemTime = item.appearTo + item.totalTime;\n\n        if (itemTime > _this.childTotalTime) {\n          _this.childTotalTime = itemTime;\n          _this.childRegionTotalTime = itemTime;\n        }\n      } else {\n        _this.childTotalTime += item.totalTime;\n        _this.childRegionTotalTime += item.totalTime;\n      }\n    }\n\n    if (_this.regionStartTime) {\n      _this.childRegionTotalTime -= _this.regionStartTime;\n    }\n\n    if (_this.regionEndTime) {\n      _this.childRegionTotalTime = _this.regionEndTime - _this.regionStartTime;\n    }\n\n    var _this$props2 = _this.props,\n        _this$props2$repeat = _this$props2.repeat,\n        repeat = _this$props2$repeat === void 0 ? 0 : _this$props2$repeat,\n        _this$props2$repeatDe = _this$props2.repeatDelay,\n        repeatDelay = _this$props2$repeatDe === void 0 ? 0 : _this$props2$repeatDe,\n        delay = _this$props2.delay;\n    _this.totalTime = repeat === -1 ? Number.MAX_VALUE : delay + _this.childTotalTime * (repeat + 1) + repeatDelay * repeat;\n    _this.totalTimeRegion = repeat === -1 ? Number.MAX_VALUE : delay + _this.childRegionTotalTime * (repeat + 1) + repeatDelay * repeat;\n  };\n\n  this.setStartTimeOrMoment = function (start) {\n    _this.startTime = Ticker.time;\n    _this.startMoment = start || _this.progressMoment;\n  };\n\n  this.reRenderCall = function () {\n    _this.render({\n      time: _this.startTime,\n      elapsed: Ticker.elapsed || Ticker.frameFPS\n    });\n  };\n\n  this.play = function (v) {\n    if (!v) {\n      var _this$parent;\n\n      (_this$parent = _this.parent) === null || _this$parent === void 0 ? void 0 : _this$parent.addChild(_this);\n    } else {\n      var _this$parent2;\n\n      (_this$parent2 = _this.parent) === null || _this$parent2 === void 0 ? void 0 : _this$parent2.updateTickerState();\n    }\n  };\n\n  this.paused = function () {\n    var v = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n    _this.pausedState = v;\n\n    _this.setStartTimeOrMoment();\n\n    _this.play(v);\n  };\n\n  this.reverse = function (v) {\n    _this.reverseState = v;\n\n    _this.setStartTimeOrMoment();\n\n    _this.play(_this.pausedState);\n  };\n\n  this.goto = function ($moment, paused) {\n    var moment = $moment - _this.regionStartTime;\n    _this.startTime = Ticker.time;\n    _this.startMoment = moment > _this.totalTime ? _this.totalTime : moment;\n    _this.progressMoment = _this.startMoment;\n    _this.progressTime = moment;\n\n    _this.play(_this.pausedState);\n\n    _this.reRenderCall();\n\n    if (!!paused !== _this.pausedState) {\n      _this.paused(paused);\n    }\n  };\n\n  this.kill = function (index) {\n    if (typeof index === 'number') {\n      _this.paused();\n\n      delete _this.children[index];\n\n      _this.setTotalTime();\n\n      _this.paused(false);\n    } else {\n      var _this$parent3;\n\n      _this.children = [];\n      (_this$parent3 = _this.parent) === null || _this$parent3 === void 0 ? void 0 : _this$parent3.removeChild(_this);\n    }\n  };\n\n  this.onChange = function (e) {\n    e.timelineMoment = _this.progressMoment;\n\n    _this.onChangeChild(e);\n  };\n\n  this.render = function (_ref) {\n    var time = _ref.time,\n        elapsed = _ref.elapsed;\n    var fps = elapsed || Ticker.frameFPS || 0;\n    var totalTime = _this.totalTime,\n        totalTimeRegion = _this.totalTimeRegion,\n        childTotalTime = _this.childTotalTime,\n        childRegionTotalTime = _this.childRegionTotalTime,\n        children = _this.children,\n        props = _this.props,\n        startTime = _this.startTime,\n        reverseState = _this.reverseState,\n        pausedState = _this.pausedState,\n        startMoment = _this.startMoment,\n        onChangeTimeline = _this.onChangeTimeline,\n        parent = _this.parent,\n        root = _this.root,\n        prevMoment = _this.prevMoment,\n        regionStartTime = _this.regionStartTime;\n    var _props$repeatDelay = props.repeatDelay,\n        repeatDelay = _props$repeatDelay === void 0 ? 0 : _props$repeatDelay,\n        yoyo = props.yoyo,\n        delay = props.delay;\n    var _props$repeat = props.repeat,\n        repeat = _props$repeat === void 0 ? 0 : _props$repeat;\n    repeat = repeat === -1 ? Number.MAX_VALUE : repeat;\n    var t = time - startTime - delay;\n    var m = reverseState ? startMoment - t : t + startMoment;\n\n    if (m < -fps) {\n      return;\n    }\n\n    var moment = m < 0 ? 0 : m;\n    moment = moment > totalTime ? totalTime : moment;\n    moment = startMoment < regionStartTime ? m : moment;\n    moment = startMoment > totalTimeRegion ? startMoment : moment;\n    var repeatNum = repeat ? Math.floor(moment / (childRegionTotalTime + repeatDelay)) : 0;\n    repeatNum = repeat && repeatNum > repeat ? repeat : repeatNum;\n    var tweenMoment = moment - (childRegionTotalTime + repeatDelay) * repeatNum;\n    var yoyoReverse = !!(yoyo && repeatNum % 2);\n    tweenMoment = yoyoReverse ? childRegionTotalTime - tweenMoment : tweenMoment;\n    tweenMoment = regionStartTime + tweenMoment;\n    var reverse = reverseState ? !yoyoReverse : yoyoReverse;\n    _this.mode = 'onTimelineUpdate';\n\n    if (typeof prevMoment !== 'number') {\n      _this.mode = 'onTimelineStart';\n    }\n\n    if (moment >= totalTimeRegion - delay && typeof prevMoment === 'number') {\n      _this.mode = 'onTimelineComplete';\n    }\n\n    if (repeatNum !== _this.repeatNum) {\n      _this.mode = 'onTimelineRepeat'; // 补帧状态;\n\n      if (moment > childTotalTime * repeatNum && moment < childTotalTime * repeatNum + fps) {\n        for (var i = reverse ? 0 : children.length - 1; reverse ? i <= children.length - 1 : i >= 0; reverse ? i++ : i--) {\n          var item = children[i]; // console.log('时间轴补帧状态', i);\n          // console.log('reverse', reverse);\n\n          if (!reverse) {\n            item.prevMoment = undefined;\n          }\n\n          item.render({\n            moment: reverse ? item.totalTime : 0,\n            fps: fps\n          });\n        }\n\n        onChangeTimeline({\n          moment: moment,\n          totalTime: totalTime,\n          repeat: repeatNum,\n          mode: _this.mode,\n          targets: root.targets\n        });\n        _this.mode = 'onTimelineUpdate';\n      }\n    }\n\n    if (repeat) {\n      _this.repeatNum = repeatNum;\n    }\n\n    _this.progressMoment = moment;\n    _this.prevMoment = moment;\n    _this.progressTime = t; // children.forEach(item => {\n\n    for (var _i = 0; _i < children.length; _i++) {\n      var _item = children[_i];\n      /* if (!item) {\n        return;\n      } */\n\n      var duration = _item.totalTime + _item.appearTo;\n      var tweenTime = tweenMoment >= _item.appearTo - fps && tweenMoment < duration + fps; // 过帧补\n\n      if (_item.mode !== 'onComplete' && tweenMoment > duration + fps && !yoyoReverse && _item.totalTime || typeof _item.mode === 'undefined' && !_item.totalTime // 时间为 0 时的过补条件\n      ) {\n          // console.log('结束', i, item.totalTime, repeatNum, yoyoReverse);\n          _item.render({\n            moment: _item.totalTime,\n            fps: fps\n          });\n\n          _item.prevMoment = undefined;\n        }\n\n      if (tweenMoment < _item.appearTo - fps && _item.mode && _item.mode !== 'onStart'\n      /* && item.totalTime ||\n      (typeof item.mode === 'undefined' && !item.totalTime) */\n      ) {\n          // console.log('重置', i, item.appearTo, tweenMoment, item.prevMoment, item.mode);\n          _item.render({\n            moment: _item.appearTo,\n            fps: fps,\n            silence: true\n          });\n\n          _item.prevMoment = undefined;\n          _item.mode = undefined;\n        }\n\n      if (tweenTime) {\n        var _t = tweenMoment < 0 ? 0 : tweenMoment;\n\n        if (tweenMoment > duration && _item.mode === 'onComplete' && !yoyoReverse) {\n          return;\n        }\n\n        _t = tweenMoment > duration ? duration : tweenMoment; // item.parentBackwards = reverse;\n\n        _item.render({\n          moment: _t - _item.appearTo,\n          fps: fps\n        });\n\n        if (!duration) {\n          // console.log('set 状态补帧', i);\n          _item.render({\n            moment: _item.totalTime,\n            fps: fps,\n            render: true\n          });\n\n          _item.prevMoment = undefined;\n        }\n      }\n    } // });\n\n\n    onChangeTimeline({\n      moment: moment,\n      totalTime: totalTime,\n      repeat: repeatNum,\n      mode: _this.mode,\n      targets: root.targets\n    });\n\n    if (pausedState || totalTimeRegion && m + delay >= totalTimeRegion && !reverseState || reverseState && m + delay <= 0 || !children.length) {\n      parent === null || parent === void 0 ? void 0 : parent.removeChild(_this);\n    }\n  };\n\n  this.props = _props;\n  var _this$props3 = this.props,\n      _paused = _this$props3.paused,\n      _reverse = _this$props3.reverse;\n  this.reverseState = _reverse;\n  this.pausedState = _paused;\n  this.regionStartTime = _props.regionStartTime || 0;\n  this.regionEndTime = _props.regionEndTime;\n});\n\nexport { AnimateGroup as default };","map":{"version":3,"sources":["/root/GraduateProject/node_modules/tween-one/es/animate/animate.js"],"names":["_createClass","_classCallCheck","Ticker","Element","dataToArray","getAnimatePos","AnimateGroup","_props","_this","props","id","children","totalTime","totalTimeRegion","childTotalTime","childRegionTotalTime","prevMoment","progressTime","progressMoment","startMoment","startTime","repeatNum","mode","pausedState","reverseState","root","parent","regionStartTime","regionEndTime","onChangeChild","onChangeTimeline","init","_this$props","reverse","animation","moment","animateArray","i","length","item","type","duration","animate","index","pos","appearTo","addChild","render","time","elapsed","goto","play","indexOf","push","setTotalTime","itemTime","_this$props2","_this$props2$repeat","repeat","_this$props2$repeatDe","repeatDelay","delay","Number","MAX_VALUE","setStartTimeOrMoment","start","reRenderCall","frameFPS","v","_this$parent","_this$parent2","updateTickerState","paused","arguments","undefined","$moment","kill","_this$parent3","removeChild","onChange","e","timelineMoment","_ref","fps","_props$repeatDelay","yoyo","_props$repeat","t","m","Math","floor","tweenMoment","yoyoReverse","targets","_i","_item","tweenTime","silence","_t","_this$props3","_paused","_reverse","default"],"mappings":"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","sourcesContent":["import _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport Ticker from './ticker';\nimport Element from './animateElement';\nimport { dataToArray, getAnimatePos } from '../utils';\n\nvar AnimateGroup = /*#__PURE__*/_createClass(function AnimateGroup(_props) {\n  var _this = this;\n\n  _classCallCheck(this, AnimateGroup);\n\n  this.props = void 0;\n  this.id = void 0;\n  this.children = [];\n  this.totalTime = 0;\n  this.totalTimeRegion = 0;\n  this.childTotalTime = 0;\n  this.childRegionTotalTime = 0;\n  this.prevMoment = void 0;\n  this.progressTime = 0;\n  this.progressMoment = -1;\n  this.startMoment = 0;\n  this.startTime = 0;\n  this.repeatNum = 0;\n  this.mode = 'onTimelineStart';\n  this.pausedState = void 0;\n  this.reverseState = void 0;\n  this.root = void 0;\n  this.parent = void 0;\n  this.regionStartTime = 0;\n  this.regionEndTime = void 0;\n  this.onChangeChild = void 0;\n  this.onChangeTimeline = void 0;\n\n  this.init = function () {\n    var _this$props = _this.props,\n        reverse = _this$props.reverse,\n        animation = _this$props.animation,\n        moment = _this$props.moment;\n    var animateArray = dataToArray(animation);\n\n    for (var i = 0; i < animateArray.length; i++) {\n      var item = animateArray[i];\n\n      if (item.type === 'set') {\n        item.duration = 0;\n      } //animateArray.forEach((item: any, i: number) => {\n\n\n      var animate = new Element(item);\n      animate.index = i;\n      var pos = i ? getAnimatePos(item, animateArray[i - 1]) : 0;\n      item.appearTo = pos;\n      animate.appearTo = pos;\n\n      _this.addChild(animate); //});\n\n    } // 注册\n\n\n    _this.render({\n      time: (reverse ? _this.totalTime : 0) + _this.startTime,\n      elapsed: 16.67\n    });\n\n    if (!_this.totalTime) {\n      _this.render({\n        time: (reverse ? _this.totalTime : 0) + _this.startTime,\n        elapsed: 16.67\n      });\n    }\n\n    if (moment) {\n      _this.goto(moment);\n    } else {\n      _this.play();\n    }\n  };\n\n  this.addChild = function (animate) {\n    animate.parent = _this;\n    animate.root = _this.root;\n\n    if (_this.children.indexOf(animate) === -1) {\n      _this.children.push(animate);\n\n      _this.setTotalTime();\n    }\n  };\n\n  this.setTotalTime = function () {\n    _this.childTotalTime = 0;\n    _this.childRegionTotalTime = 0;\n\n    for (var i = 0; i < _this.children.length; i++) {\n      var item = _this.children[i];\n\n      if (item.appearTo !== _this.childTotalTime) {\n        var itemTime = item.appearTo + item.totalTime;\n\n        if (itemTime > _this.childTotalTime) {\n          _this.childTotalTime = itemTime;\n          _this.childRegionTotalTime = itemTime;\n        }\n      } else {\n        _this.childTotalTime += item.totalTime;\n        _this.childRegionTotalTime += item.totalTime;\n      }\n    }\n\n    if (_this.regionStartTime) {\n      _this.childRegionTotalTime -= _this.regionStartTime;\n    }\n\n    if (_this.regionEndTime) {\n      _this.childRegionTotalTime = _this.regionEndTime - _this.regionStartTime;\n    }\n\n    var _this$props2 = _this.props,\n        _this$props2$repeat = _this$props2.repeat,\n        repeat = _this$props2$repeat === void 0 ? 0 : _this$props2$repeat,\n        _this$props2$repeatDe = _this$props2.repeatDelay,\n        repeatDelay = _this$props2$repeatDe === void 0 ? 0 : _this$props2$repeatDe,\n        delay = _this$props2.delay;\n    _this.totalTime = repeat === -1 ? Number.MAX_VALUE : delay + _this.childTotalTime * (repeat + 1) + repeatDelay * repeat;\n    _this.totalTimeRegion = repeat === -1 ? Number.MAX_VALUE : delay + _this.childRegionTotalTime * (repeat + 1) + repeatDelay * repeat;\n  };\n\n  this.setStartTimeOrMoment = function (start) {\n    _this.startTime = Ticker.time;\n    _this.startMoment = start || _this.progressMoment;\n  };\n\n  this.reRenderCall = function () {\n    _this.render({\n      time: _this.startTime,\n      elapsed: Ticker.elapsed || Ticker.frameFPS\n    });\n  };\n\n  this.play = function (v) {\n    if (!v) {\n      var _this$parent;\n\n      (_this$parent = _this.parent) === null || _this$parent === void 0 ? void 0 : _this$parent.addChild(_this);\n    } else {\n      var _this$parent2;\n\n      (_this$parent2 = _this.parent) === null || _this$parent2 === void 0 ? void 0 : _this$parent2.updateTickerState();\n    }\n  };\n\n  this.paused = function () {\n    var v = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n    _this.pausedState = v;\n\n    _this.setStartTimeOrMoment();\n\n    _this.play(v);\n  };\n\n  this.reverse = function (v) {\n    _this.reverseState = v;\n\n    _this.setStartTimeOrMoment();\n\n    _this.play(_this.pausedState);\n  };\n\n  this.goto = function ($moment, paused) {\n    var moment = $moment - _this.regionStartTime;\n    _this.startTime = Ticker.time;\n    _this.startMoment = moment > _this.totalTime ? _this.totalTime : moment;\n    _this.progressMoment = _this.startMoment;\n    _this.progressTime = moment;\n\n    _this.play(_this.pausedState);\n\n    _this.reRenderCall();\n\n    if (!!paused !== _this.pausedState) {\n      _this.paused(paused);\n    }\n  };\n\n  this.kill = function (index) {\n    if (typeof index === 'number') {\n      _this.paused();\n\n      delete _this.children[index];\n\n      _this.setTotalTime();\n\n      _this.paused(false);\n    } else {\n      var _this$parent3;\n\n      _this.children = [];\n      (_this$parent3 = _this.parent) === null || _this$parent3 === void 0 ? void 0 : _this$parent3.removeChild(_this);\n    }\n  };\n\n  this.onChange = function (e) {\n    e.timelineMoment = _this.progressMoment;\n\n    _this.onChangeChild(e);\n  };\n\n  this.render = function (_ref) {\n    var time = _ref.time,\n        elapsed = _ref.elapsed;\n    var fps = elapsed || Ticker.frameFPS || 0;\n    var totalTime = _this.totalTime,\n        totalTimeRegion = _this.totalTimeRegion,\n        childTotalTime = _this.childTotalTime,\n        childRegionTotalTime = _this.childRegionTotalTime,\n        children = _this.children,\n        props = _this.props,\n        startTime = _this.startTime,\n        reverseState = _this.reverseState,\n        pausedState = _this.pausedState,\n        startMoment = _this.startMoment,\n        onChangeTimeline = _this.onChangeTimeline,\n        parent = _this.parent,\n        root = _this.root,\n        prevMoment = _this.prevMoment,\n        regionStartTime = _this.regionStartTime;\n    var _props$repeatDelay = props.repeatDelay,\n        repeatDelay = _props$repeatDelay === void 0 ? 0 : _props$repeatDelay,\n        yoyo = props.yoyo,\n        delay = props.delay;\n    var _props$repeat = props.repeat,\n        repeat = _props$repeat === void 0 ? 0 : _props$repeat;\n    repeat = repeat === -1 ? Number.MAX_VALUE : repeat;\n    var t = time - startTime - delay;\n    var m = reverseState ? startMoment - t : t + startMoment;\n\n    if (m < -fps) {\n      return;\n    }\n\n    var moment = m < 0 ? 0 : m;\n    moment = moment > totalTime ? totalTime : moment;\n    moment = startMoment < regionStartTime ? m : moment;\n    moment = startMoment > totalTimeRegion ? startMoment : moment;\n    var repeatNum = repeat ? Math.floor(moment / (childRegionTotalTime + repeatDelay)) : 0;\n    repeatNum = repeat && repeatNum > repeat ? repeat : repeatNum;\n    var tweenMoment = moment - (childRegionTotalTime + repeatDelay) * repeatNum;\n    var yoyoReverse = !!(yoyo && repeatNum % 2);\n    tweenMoment = yoyoReverse ? childRegionTotalTime - tweenMoment : tweenMoment;\n    tweenMoment = regionStartTime + tweenMoment;\n    var reverse = reverseState ? !yoyoReverse : yoyoReverse;\n    _this.mode = 'onTimelineUpdate';\n\n    if (typeof prevMoment !== 'number') {\n      _this.mode = 'onTimelineStart';\n    }\n\n    if (moment >= totalTimeRegion - delay && typeof prevMoment === 'number') {\n      _this.mode = 'onTimelineComplete';\n    }\n\n    if (repeatNum !== _this.repeatNum) {\n      _this.mode = 'onTimelineRepeat'; // 补帧状态;\n\n      if (moment > childTotalTime * repeatNum && moment < childTotalTime * repeatNum + fps) {\n        for (var i = reverse ? 0 : children.length - 1; reverse ? i <= children.length - 1 : i >= 0; reverse ? i++ : i--) {\n          var item = children[i]; // console.log('时间轴补帧状态', i);\n          // console.log('reverse', reverse);\n\n          if (!reverse) {\n            item.prevMoment = undefined;\n          }\n\n          item.render({\n            moment: reverse ? item.totalTime : 0,\n            fps: fps\n          });\n        }\n\n        onChangeTimeline({\n          moment: moment,\n          totalTime: totalTime,\n          repeat: repeatNum,\n          mode: _this.mode,\n          targets: root.targets\n        });\n        _this.mode = 'onTimelineUpdate';\n      }\n    }\n\n    if (repeat) {\n      _this.repeatNum = repeatNum;\n    }\n\n    _this.progressMoment = moment;\n    _this.prevMoment = moment;\n    _this.progressTime = t; // children.forEach(item => {\n\n    for (var _i = 0; _i < children.length; _i++) {\n      var _item = children[_i];\n      /* if (!item) {\n        return;\n      } */\n\n      var duration = _item.totalTime + _item.appearTo;\n      var tweenTime = tweenMoment >= _item.appearTo - fps && tweenMoment < duration + fps; // 过帧补\n\n      if (_item.mode !== 'onComplete' && tweenMoment > duration + fps && !yoyoReverse && _item.totalTime || typeof _item.mode === 'undefined' && !_item.totalTime // 时间为 0 时的过补条件\n      ) {\n        // console.log('结束', i, item.totalTime, repeatNum, yoyoReverse);\n        _item.render({\n          moment: _item.totalTime,\n          fps: fps\n        });\n\n        _item.prevMoment = undefined;\n      }\n\n      if (tweenMoment < _item.appearTo - fps && _item.mode && _item.mode !== 'onStart'\n      /* && item.totalTime ||\n      (typeof item.mode === 'undefined' && !item.totalTime) */\n      ) {\n        // console.log('重置', i, item.appearTo, tweenMoment, item.prevMoment, item.mode);\n        _item.render({\n          moment: _item.appearTo,\n          fps: fps,\n          silence: true\n        });\n\n        _item.prevMoment = undefined;\n        _item.mode = undefined;\n      }\n\n      if (tweenTime) {\n        var _t = tweenMoment < 0 ? 0 : tweenMoment;\n\n        if (tweenMoment > duration && _item.mode === 'onComplete' && !yoyoReverse) {\n          return;\n        }\n\n        _t = tweenMoment > duration ? duration : tweenMoment; // item.parentBackwards = reverse;\n\n        _item.render({\n          moment: _t - _item.appearTo,\n          fps: fps\n        });\n\n        if (!duration) {\n          // console.log('set 状态补帧', i);\n          _item.render({\n            moment: _item.totalTime,\n            fps: fps,\n            render: true\n          });\n\n          _item.prevMoment = undefined;\n        }\n      }\n    } // });\n\n\n    onChangeTimeline({\n      moment: moment,\n      totalTime: totalTime,\n      repeat: repeatNum,\n      mode: _this.mode,\n      targets: root.targets\n    });\n\n    if (pausedState || totalTimeRegion && m + delay >= totalTimeRegion && !reverseState || reverseState && m + delay <= 0 || !children.length) {\n      parent === null || parent === void 0 ? void 0 : parent.removeChild(_this);\n    }\n  };\n\n  this.props = _props;\n  var _this$props3 = this.props,\n      _paused = _this$props3.paused,\n      _reverse = _this$props3.reverse;\n  this.reverseState = _reverse;\n  this.pausedState = _paused;\n  this.regionStartTime = _props.regionStartTime || 0;\n  this.regionEndTime = _props.regionEndTime;\n});\n\nexport { AnimateGroup as default };"]},"metadata":{},"sourceType":"module"}