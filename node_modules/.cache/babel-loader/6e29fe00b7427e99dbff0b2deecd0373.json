{"ast":null,"code":"import _regeneratorRuntime from\"/root/GraduateProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/root/GraduateProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/root/GraduateProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/root/GraduateProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import*as API from'./Api';import moment from'moment';import{AuthStrategy,AuthResult}from'../types/Auth';import authenticationConfig from'../config/AuthenticationConfig';var AnonymousLogin=/*#__PURE__*/function(){function AnonymousLogin(){_classCallCheck(this,AnonymousLogin);}_createClass(AnonymousLogin,[{key:\"prepare\",value:function(){var _prepare=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(_info){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",AuthResult.CONTINUE);case 1:case\"end\":return _context.stop();}}},_callee);}));function prepare(_x){return _prepare.apply(this,arguments);}return prepare;}()},{key:\"perform\",value:function(){var _perform=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_request){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",{status:AuthResult.FAILURE,session:{username:API.ANONYMOUS_USER,expiresOn:moment().add(1,'d').toISOString()}});case 1:case\"end\":return _context2.stop();}}},_callee2);}));function perform(_x2){return _perform.apply(this,arguments);}return perform;}()}]);return AnonymousLogin;}();var TokenLogin=/*#__PURE__*/function(){function TokenLogin(){_classCallCheck(this,TokenLogin);}_createClass(TokenLogin,[{key:\"prepare\",value:function(){var _prepare2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_info){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",AuthResult.CONTINUE);case 1:case\"end\":return _context3.stop();}}},_callee3);}));function prepare(_x3){return _prepare2.apply(this,arguments);}return prepare;}()},{key:\"perform\",value:function(){var _perform2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(request){var session;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return API.login({username:'',password:'',token:request.data.password});case 2:session=_context4.sent.data;return _context4.abrupt(\"return\",{status:AuthResult.SUCCESS,session:session});case 4:case\"end\":return _context4.stop();}}},_callee4);}));function perform(_x4){return _perform2.apply(this,arguments);}return perform;}()}]);return TokenLogin;}();var HeaderLogin=/*#__PURE__*/function(){function HeaderLogin(){_classCallCheck(this,HeaderLogin);}_createClass(HeaderLogin,[{key:\"prepare\",value:function(){var _prepare3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(_info){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:return _context5.abrupt(\"return\",AuthResult.CONTINUE);case 1:case\"end\":return _context5.stop();}}},_callee5);}));function prepare(_x5){return _prepare3.apply(this,arguments);}return prepare;}()},{key:\"perform\",value:function(){var _perform3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(_request){var session;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return API.login({username:'',password:'',token:''});case 2:session=_context6.sent.data;return _context6.abrupt(\"return\",{status:AuthResult.SUCCESS,session:session});case 4:case\"end\":return _context6.stop();}}},_callee6);}));function perform(_x6){return _perform3.apply(this,arguments);}return perform;}()}]);return HeaderLogin;}();var OAuthLogin=/*#__PURE__*/function(){function OAuthLogin(){_classCallCheck(this,OAuthLogin);}_createClass(OAuthLogin,[{key:\"prepare\",value:function(){var _prepare4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(info){var pattern;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:if(info.authorizationEndpoint){_context7.next=2;break;}return _context7.abrupt(\"return\",AuthResult.FAILURE);case 2:pattern=/[#&](access_token|id_token)=/;if(!pattern.test(window.location.hash)){_context7.next=7;break;}return _context7.abrupt(\"return\",AuthResult.CONTINUE);case 7:return _context7.abrupt(\"return\",AuthResult.HOLD);case 8:case\"end\":return _context7.stop();}}},_callee7);}));function prepare(_x7){return _prepare4.apply(this,arguments);}return prepare;}()},{key:\"perform\",value:function(){var _perform4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(_request){var session;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return API.checkOpenshiftAuth(window.location.hash.substring(1));case 2:session=_context8.sent.data;// remove the data that was passed by the OAuth login. In certain error situations this can cause the\n// page to enter a refresh loop since it tries to reload the page which then tries to reuse the bad token again.\nwindow.history.replaceState('',document.title,window.location.pathname+window.location.search);return _context8.abrupt(\"return\",{status:AuthResult.SUCCESS,session:session});case 5:case\"end\":return _context8.stop();}}},_callee8);}));function perform(_x8){return _perform4.apply(this,arguments);}return perform;}()}]);return OAuthLogin;}();export var LoginDispatcher=/*#__PURE__*/function(){function LoginDispatcher(){_classCallCheck(this,LoginDispatcher);this.strategyMapping=void 0;this.info=void 0;this.strategyMapping=new Map();this.strategyMapping.set(AuthStrategy.anonymous,new AnonymousLogin());this.strategyMapping.set(AuthStrategy.openshift,new OAuthLogin());this.strategyMapping.set(AuthStrategy.token,new TokenLogin());this.strategyMapping.set(AuthStrategy.openid,new OAuthLogin());this.strategyMapping.set(AuthStrategy.header,new HeaderLogin());}_createClass(LoginDispatcher,[{key:\"prepare\",value:function(){var _prepare5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(){var info,strategy,delay,result;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:info=authenticationConfig;strategy=this.strategyMapping.get(info.strategy);_context10.prev=2;delay=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(){var ms,_args9=arguments;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:ms=_args9.length>0&&_args9[0]!==undefined?_args9[0]:3000;return _context9.abrupt(\"return\",new Promise(function(resolve){return setTimeout(resolve,ms);}));case 2:case\"end\":return _context9.stop();}}},_callee9);}));return function delay(){return _ref.apply(this,arguments);};}();_context10.next=6;return strategy.prepare(info);case 6:result=_context10.sent;if(!(result===AuthResult.HOLD)){_context10.next=13;break;}_context10.next=10;return delay();case 10:return _context10.abrupt(\"return\",Promise.reject({status:AuthResult.FAILURE,error:'Failed to redirect user to authentication page.'}));case 13:return _context10.abrupt(\"return\",result);case 14:_context10.next=19;break;case 16:_context10.prev=16;_context10.t0=_context10[\"catch\"](2);return _context10.abrupt(\"return\",Promise.reject({status:AuthResult.FAILURE,error:_context10.t0}));case 19:case\"end\":return _context10.stop();}}},_callee10,this,[[2,16]]);}));function prepare(){return _prepare5.apply(this,arguments);}return prepare;}()},{key:\"perform\",value:function(){var _perform5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(request){var strategy;return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:strategy=this.strategyMapping.get(authenticationConfig.strategy);_context11.prev=1;_context11.next=4;return strategy.perform(request);case 4:return _context11.abrupt(\"return\",_context11.sent);case 7:_context11.prev=7;_context11.t0=_context11[\"catch\"](1);return _context11.abrupt(\"return\",Promise.reject({status:AuthResult.FAILURE,error:_context11.t0}));case 10:case\"end\":return _context11.stop();}}},_callee11,this,[[1,7]]);}));function perform(_x9){return _perform5.apply(this,arguments);}return perform;}()}]);return LoginDispatcher;}();","map":null,"metadata":{},"sourceType":"module"}