{"ast":null,"code":"import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _typeof from \"@babel/runtime/helpers/esm/typeof\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\n/**\n * Animate\n * 动画处理器\n * 滤境管理\n *\n * Animate 时间组成\n * [1.---delay---][1.---duration---][1.---repeatDelay---][2.---duration---]\n * repeatDelay 跟在时间后面；\n * 总时间 totalTime: delay + duration * (repeat + 1) + repeatDelay * repeat;\n *\n * 回调事件处理\n * repeat = 0:\n * [---delay---][---onStart(0)---][---onUpdate(duration)---][---onComplete(totalTime)---]\n * repeat = 2:\n * 1.[---delay---][---onStart(0)---][---onUpdate(duration)---][---repeatDelay---]\n * 2.[---onRepeat(0)---][---onUpdate(duration)---][---repeatDelay---]\n * 3.[---onRepeat(0)---][---onUpdate( duration)---][---onComplete(totalTime)---]\n *\n */\n\nimport { initAnimProps, getDefaultStart, getValue, getStartAtValue, flatArray, shadowExp } from '../utils';\nimport ease from './ease';\nimport { Plugins } from '../';\n\nvar Element = /*#__PURE__*/function () {\n  function Element(_item) {\n    var _this = this;\n\n    _classCallCheck(this, Element);\n\n    this.item = void 0;\n    this.vars = {};\n    this.start = void 0;\n    this.parent = void 0;\n    this.root = void 0;\n    this.startAt = {};\n    this.mode = void 0;\n    this.appearTo = 0;\n    this.props = {};\n    this.index = void 0;\n    this.register = void 0;\n    this.reverseStart = void 0;\n    this.repeatNum = 0;\n    this.prevMoment = void 0;\n    this.easing = void 0;\n\n    this.changeValueToVars = function (k, value, skipPlugin) {\n      var isArray = (Array.isArray(value) || k.match(/color|fill|stroke/i) || k.match(shadowExp) && typeof value === 'string' || typeof value === 'string' && value.split(/[\\s|,]/).length > 1) && !(k in Plugins);\n\n      if (k in Plugins || isArray) {\n        if (skipPlugin) {\n          return value;\n        }\n\n        return {\n          value: value,\n          plugins: [],\n          array: isArray\n        };\n      }\n\n      var vars = parseFloat(value.toString().replace(/=/g, ''));\n      var unit = value.toString().replace(/[^a-z|%]/g, ''); // +=, -= 匹配\n\n      var count = value.toString().charAt(1) === '=' ? value.toString().replace(/[^\\+\\=|\\-\\=]/gi, '') : ''; // const startUnit = (this.startAt[k] && this.startAt[k].unit) || '';\n      // console.log(unit, startUnit);\n\n      /* if (\n        unit !== startUnit &&\n        this.startAt[k] &&\n        this.startAt[k].vars !== getDefaultStart(k)\n      ) {\n        console.warn(\n          `Warning: animation vars(${value}) units(${unit ||\n            'px'}) are not equal to startAt(${startUnit || 'px'}).`,\n        );\n      } */\n\n      return {\n        vars: vars,\n        unit: unit,\n        count: count\n      };\n    };\n\n    this.setEase = function (e) {\n      if (typeof e === 'function') {\n        _this.easing = e;\n        return;\n      } else if (e.match(/,/g)) {\n        _this.easing = ease.path(e);\n        return;\n      }\n\n      _this.easing = ease[e];\n    };\n\n    this.getTotalTime = function () {\n      var _this$props = _this.props,\n          _this$props$duration = _this$props.duration,\n          duration = _this$props$duration === void 0 ? 450 : _this$props$duration,\n          _this$props$delay = _this$props.delay,\n          delay = _this$props$delay === void 0 ? 0 : _this$props$delay,\n          _this$props$repeat = _this$props.repeat,\n          repeat = _this$props$repeat === void 0 ? 0 : _this$props$repeat,\n          _this$props$repeatDel = _this$props.repeatDelay,\n          repeatDelay = _this$props$repeatDel === void 0 ? 0 : _this$props$repeatDel;\n      return repeat === -1 ? Number.MAX_VALUE : delay + duration * (repeat + 1) + repeatDelay * repeat;\n    };\n\n    this.getEaseToRatio = function (r, isFrom) {\n      var _this$props$ease = _this.props.ease,\n          ease = _this$props$ease === void 0 ? '' : _this$props$ease;\n      return (r === 0 || r === 1) && !(typeof ease === 'function' || ease.match(/,/g)) ? r : _this.easing(isFrom ? 1 - r : r, isFrom ? 1 : 0, isFrom ? 0 : 1, 1);\n    };\n\n    this.setRatioToVars = function (ratio) {\n      var vars = _this.vars,\n          root = _this.root;\n\n      for (var i = 0; i < root.targets.length; i++) {\n        if (!root.targets[i]) {\n          continue;\n        } // root.targets.forEach((_, i) => {\n\n\n        for (var key in vars) {\n          // Object.keys(vars).forEach((key: string) => {\n          var item = vars[key];\n\n          if (item.plugins) {\n            if (key === 'PathMotion') {\n              // pathMotion 的属性与 style 通用。不需新增；\n              root.vars[i].style = item.plugins[i].render(ratio);\n            } else {\n              root.vars[i][key] = item.plugins[i].render(ratio);\n            }\n\n            continue;\n          }\n\n          var endVars = item.vars,\n              count = item.count,\n              unit = item.unit;\n          var startVars = _this.start[i][key];\n          root.vars[i][key] = getValue(startVars, endVars, ratio, count, unit); //});\n        } //});\n\n      }\n    };\n\n    this.onRegisterAnimate = function () {\n      _this.register = true;\n      var root = _this.root,\n          parent = _this.parent,\n          startAt = _this.startAt;\n      var start = [];\n\n      for (var i = 0; i < root.targets.length; i++) {\n        var target = root.targets[i];\n        var vars = root.vars[i];\n        var s = {};\n\n        for (var key in _this.vars) {\n          var cItem = _this.vars[key];\n\n          if (cItem.plugins) {\n            var plugin = new Plugins[cItem.array ? 'ArrayPlugin' : key](cItem.value, key);\n            plugin.target = target;\n            plugin.root = root;\n            plugin.parent = parent;\n            plugin.targetIndex = i;\n            plugin.tweenVars = vars;\n            plugin.index = _this.index;\n            plugin.startAt = startAt;\n            s[key] = plugin.getAnimStart();\n            cItem.plugins.push(plugin);\n          } else {\n            var _ref, _startAt$key;\n\n            var targetValue = (_ref = root.attr ? target.getAttribute(key) : vars[key] || target[key]) !== null && _ref !== void 0 ? _ref : getDefaultStart(key);\n            var startData = (_startAt$key = startAt[key]) !== null && _startAt$key !== void 0 ? _startAt$key : targetValue; // root.vars[i][key] ??\n\n            var isStartAt = _typeof(startData) === 'object' && 'vars' in startData && 'count' in startData;\n            var unit = isStartAt ? startData.unit : \"\".concat(startData).replace(/[^a-z|%]/g, '');\n            var varsUnit = cItem.unit;\n\n            if (unit && unit !== varsUnit) {\n              console.warn(\"Different units, start unit \".concat(unit, \", to value unit \").concat(varsUnit, \", remove start unit.\"));\n            }\n\n            s[key] = isStartAt ? getStartAtValue(targetValue, startData) : parseFloat(startData);\n          }\n        }\n\n        start.push(s);\n      }\n\n      _this.start = start;\n    };\n\n    this.overflowRatio = function (ratio) {\n      var r = ratio < 0 ? 0 : ratio;\n      var duration = _this.props.duration;\n      r = r > duration ? duration : r;\n      return r;\n    };\n\n    this.render = function (_ref2) {\n      var moment = _ref2.moment,\n          _ref2$fps = _ref2.fps,\n          fps = _ref2$fps === void 0 ? 0 : _ref2$fps,\n          silence = _ref2.silence,\n          render = _ref2.render;\n      var parent = _this.parent,\n          root = _this.root,\n          props = _this.props;\n      var targets = flatArray(root.targets);\n      var onChange = parent.onChange;\n      var _props$repeat = props.repeat,\n          repeat = _props$repeat === void 0 ? 0 : _props$repeat;\n      var _props$type = props.type,\n          type = _props$type === void 0 ? 'to' : _props$type,\n          _props$duration = props.duration,\n          duration = _props$duration === void 0 ? 450 : _props$duration,\n          _props$delay = props.delay,\n          delay = _props$delay === void 0 ? 0 : _props$delay,\n          _props$repeatDelay = props.repeatDelay,\n          repeatDelay = _props$repeatDelay === void 0 ? 0 : _props$repeatDelay,\n          yoyo = props.yoyo;\n      repeat = repeat === -1 ? Number.MAX_VALUE : repeat;\n      var ratio = moment - delay; // const totalTime = duration + delay;\n\n      var repeatNum = Math.floor(ratio / (duration + repeatDelay)) || 0;\n      repeatNum = repeatNum > repeat ? repeat : repeatNum;\n      repeatNum = repeatNum < 0 ? 0 : repeatNum;\n      ratio = ratio - (duration + repeatDelay) * repeatNum;\n      /**\n       * 反向播放 isFrom 与 yoyoReverse 的区别\n       * 反向播放: isFrom\n       * [---delay---][---isFrom duration---]\n       * yoyo\n       * [---duration---][---delay---]\n       * backwards\n       * 两个都为 true 时为 false;\n       */\n\n      var yoyoReverse = !!(yoyo && repeatNum % 2);\n      var isFrom = type === 'from';\n      var backwards = yoyoReverse && isFrom ? false : yoyoReverse || isFrom;\n      ratio = backwards ? duration - ratio : ratio;\n      var fromDelay = isFrom ? 0 : delay;\n      var r = backwards ? 1 : 0; // 0 进入时的注册\n\n      if (!_this.register && moment >= fromDelay) {\n        _this.onRegisterAnimate(); // 时间超出当前动画时间的处理\n\n\n        if (backwards && ratio <= 0 || !backwards && ratio >= duration && duration) {\n          // this.mode = 'onComplete';\n          _this.prevMoment = moment;\n          r = backwards ? 0 : 1;\n        }\n\n        _this.setRatioToVars(r); // 初始注册，改变外部 vars;\n\n\n        onChange({\n          index: _this.index,\n          vars: root.vars\n        });\n      }\n\n      if (_this.register && moment > delay - fps && moment < _this.totalTime + fps) {\n        ratio = _this.overflowRatio(ratio);\n        r = backwards ? 1 : 0;\n\n        if (moment >= _this.totalTime && _this.mode !== 'onComplete' && _this.prevMoment !== undefined || _this.prevMoment === undefined && moment >= _this.totalTime && duration) {\n          r = backwards ? 0 : 1;\n          _this.mode = 'onComplete';\n\n          if (_this.props.onComplete) {\n            _this.props.onComplete({\n              mode: _this.mode,\n              index: _this.index,\n              moment: ratio,\n              ratio: r,\n              targets: targets,\n              vars: flatArray(root.vars)\n            });\n          }\n        } else if (_this.prevMoment === undefined || moment <= 0 && moment > -fps && _this.mode !== 'onStart' && _this.prevMoment > moment) {\n          _this.mode = 'onStart';\n\n          if (_this.props.onStart) {\n            _this.props.onStart({\n              mode: _this.mode,\n              index: _this.index,\n              moment: ratio,\n              ratio: r,\n              targets: targets,\n              vars: flatArray(root.vars)\n            });\n          }\n        } else {\n          r = ratio && duration ? ratio / duration : 0;\n          _this.mode = 'onUpdate';\n\n          if (_this.props.onUpdate) {\n            _this.props.onUpdate({\n              mode: _this.mode,\n              index: _this.index,\n              moment: ratio,\n              ratio: r,\n              targets: targets,\n              vars: flatArray(root.vars)\n            });\n          }\n        }\n\n        if (repeat && repeatNum !== _this.repeatNum && moment && _this.mode === 'onUpdate') {\n          _this.mode = 'onRepeat';\n\n          if (_this.props.onRepeat) {\n            _this.props.onRepeat({\n              mode: _this.mode,\n              index: _this.index,\n              moment: ratio,\n              ratio: r,\n              targets: targets,\n              vars: flatArray(_this.root.vars)\n            });\n          }\n        }\n\n        _this.setRatioToVars(_this.getEaseToRatio(r, isFrom));\n\n        if (repeat) {\n          _this.repeatNum = repeatNum;\n        }\n\n        var cb = {\n          mode: _this.mode,\n          moment: ratio,\n          repeat: repeatNum,\n          ratio: r,\n          targets: root.targets,\n          vars: root.vars,\n          index: _this.index\n        };\n\n        if (silence) {\n          cb.silence = silence;\n        }\n\n        if (render) {\n          cb.render = render;\n        }\n\n        onChange(cb);\n        _this.prevMoment = moment;\n      }\n    };\n\n    this.item = _item; // delete item.appearTo;\n\n    this.startAt = _item.startAt || {};\n    Object.keys(this.startAt).forEach(function (c) {\n      _this.startAt[c] = _this.changeValueToVars(c, _this.startAt[c], true);\n    }); // delete item.startAt;\n\n    var _props = {};\n\n    for (var k in _item) {\n      var value = _item[k];\n\n      if (!(k in initAnimProps)) {\n        this.vars[k] = this.changeValueToVars(k, value);\n      } else {\n        _props[k] = value;\n      }\n    }\n\n    this.props = _objectSpread(_objectSpread({}, initAnimProps), _props);\n    this.setEase(this.props.ease);\n  }\n\n  _createClass(Element, [{\n    key: \"totalTime\",\n    get: // parentBackwards?: boolean;\n    function get() {\n      return this.getTotalTime();\n    }\n  }]);\n\n  return Element;\n}();\n\nexport { Element as default };","map":{"version":3,"sources":["/root/GraduateProject/node_modules/tween-one/es/animate/animateElement.js"],"names":["_objectSpread","_typeof","_classCallCheck","_createClass","initAnimProps","getDefaultStart","getValue","getStartAtValue","flatArray","shadowExp","ease","Plugins","Element","_item","_this","item","vars","start","parent","root","startAt","mode","appearTo","props","index","register","reverseStart","repeatNum","prevMoment","easing","changeValueToVars","k","value","skipPlugin","isArray","Array","match","split","length","plugins","array","parseFloat","toString","replace","unit","count","charAt","setEase","e","path","getTotalTime","_this$props","_this$props$duration","duration","_this$props$delay","delay","_this$props$repeat","repeat","_this$props$repeatDel","repeatDelay","Number","MAX_VALUE","getEaseToRatio","r","isFrom","_this$props$ease","setRatioToVars","ratio","i","targets","key","style","render","endVars","startVars","onRegisterAnimate","target","s","cItem","plugin","targetIndex","tweenVars","getAnimStart","push","_ref","_startAt$key","targetValue","attr","getAttribute","startData","isStartAt","concat","varsUnit","console","warn","overflowRatio","_ref2","moment","_ref2$fps","fps","silence","onChange","_props$repeat","_props$type","type","_props$duration","_props$delay","_props$repeatDelay","yoyo","Math","floor","yoyoReverse","backwards","fromDelay","totalTime","undefined","onComplete","onStart","onUpdate","onRepeat","cb","Object","keys","forEach","c","_props","get","default"],"mappings":"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","sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _typeof from \"@babel/runtime/helpers/esm/typeof\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\n\n/**\n * Animate\n * 动画处理器\n * 滤境管理\n *\n * Animate 时间组成\n * [1.---delay---][1.---duration---][1.---repeatDelay---][2.---duration---]\n * repeatDelay 跟在时间后面；\n * 总时间 totalTime: delay + duration * (repeat + 1) + repeatDelay * repeat;\n *\n * 回调事件处理\n * repeat = 0:\n * [---delay---][---onStart(0)---][---onUpdate(duration)---][---onComplete(totalTime)---]\n * repeat = 2:\n * 1.[---delay---][---onStart(0)---][---onUpdate(duration)---][---repeatDelay---]\n * 2.[---onRepeat(0)---][---onUpdate(duration)---][---repeatDelay---]\n * 3.[---onRepeat(0)---][---onUpdate( duration)---][---onComplete(totalTime)---]\n *\n */\nimport { initAnimProps, getDefaultStart, getValue, getStartAtValue, flatArray, shadowExp } from '../utils';\nimport ease from './ease';\nimport { Plugins } from '../';\n\nvar Element = /*#__PURE__*/function () {\n  function Element(_item) {\n    var _this = this;\n\n    _classCallCheck(this, Element);\n\n    this.item = void 0;\n    this.vars = {};\n    this.start = void 0;\n    this.parent = void 0;\n    this.root = void 0;\n    this.startAt = {};\n    this.mode = void 0;\n    this.appearTo = 0;\n    this.props = {};\n    this.index = void 0;\n    this.register = void 0;\n    this.reverseStart = void 0;\n    this.repeatNum = 0;\n    this.prevMoment = void 0;\n    this.easing = void 0;\n\n    this.changeValueToVars = function (k, value, skipPlugin) {\n      var isArray = (Array.isArray(value) || k.match(/color|fill|stroke/i) || k.match(shadowExp) && typeof value === 'string' || typeof value === 'string' && value.split(/[\\s|,]/).length > 1) && !(k in Plugins);\n\n      if (k in Plugins || isArray) {\n        if (skipPlugin) {\n          return value;\n        }\n\n        return {\n          value: value,\n          plugins: [],\n          array: isArray\n        };\n      }\n\n      var vars = parseFloat(value.toString().replace(/=/g, ''));\n      var unit = value.toString().replace(/[^a-z|%]/g, ''); // +=, -= 匹配\n\n      var count = value.toString().charAt(1) === '=' ? value.toString().replace(/[^\\+\\=|\\-\\=]/gi, '') : ''; // const startUnit = (this.startAt[k] && this.startAt[k].unit) || '';\n      // console.log(unit, startUnit);\n\n      /* if (\n        unit !== startUnit &&\n        this.startAt[k] &&\n        this.startAt[k].vars !== getDefaultStart(k)\n      ) {\n        console.warn(\n          `Warning: animation vars(${value}) units(${unit ||\n            'px'}) are not equal to startAt(${startUnit || 'px'}).`,\n        );\n      } */\n\n      return {\n        vars: vars,\n        unit: unit,\n        count: count\n      };\n    };\n\n    this.setEase = function (e) {\n      if (typeof e === 'function') {\n        _this.easing = e;\n        return;\n      } else if (e.match(/,/g)) {\n        _this.easing = ease.path(e);\n        return;\n      }\n\n      _this.easing = ease[e];\n    };\n\n    this.getTotalTime = function () {\n      var _this$props = _this.props,\n          _this$props$duration = _this$props.duration,\n          duration = _this$props$duration === void 0 ? 450 : _this$props$duration,\n          _this$props$delay = _this$props.delay,\n          delay = _this$props$delay === void 0 ? 0 : _this$props$delay,\n          _this$props$repeat = _this$props.repeat,\n          repeat = _this$props$repeat === void 0 ? 0 : _this$props$repeat,\n          _this$props$repeatDel = _this$props.repeatDelay,\n          repeatDelay = _this$props$repeatDel === void 0 ? 0 : _this$props$repeatDel;\n      return repeat === -1 ? Number.MAX_VALUE : delay + duration * (repeat + 1) + repeatDelay * repeat;\n    };\n\n    this.getEaseToRatio = function (r, isFrom) {\n      var _this$props$ease = _this.props.ease,\n          ease = _this$props$ease === void 0 ? '' : _this$props$ease;\n      return (r === 0 || r === 1) && !(typeof ease === 'function' || ease.match(/,/g)) ? r : _this.easing(isFrom ? 1 - r : r, isFrom ? 1 : 0, isFrom ? 0 : 1, 1);\n    };\n\n    this.setRatioToVars = function (ratio) {\n      var vars = _this.vars,\n          root = _this.root;\n\n      for (var i = 0; i < root.targets.length; i++) {\n        if (!root.targets[i]) {\n          continue;\n        } // root.targets.forEach((_, i) => {\n\n\n        for (var key in vars) {\n          // Object.keys(vars).forEach((key: string) => {\n          var item = vars[key];\n\n          if (item.plugins) {\n            if (key === 'PathMotion') {\n              // pathMotion 的属性与 style 通用。不需新增；\n              root.vars[i].style = item.plugins[i].render(ratio);\n            } else {\n              root.vars[i][key] = item.plugins[i].render(ratio);\n            }\n\n            continue;\n          }\n\n          var endVars = item.vars,\n              count = item.count,\n              unit = item.unit;\n          var startVars = _this.start[i][key];\n          root.vars[i][key] = getValue(startVars, endVars, ratio, count, unit); //});\n        } //});\n\n      }\n    };\n\n    this.onRegisterAnimate = function () {\n      _this.register = true;\n      var root = _this.root,\n          parent = _this.parent,\n          startAt = _this.startAt;\n      var start = [];\n\n      for (var i = 0; i < root.targets.length; i++) {\n        var target = root.targets[i];\n        var vars = root.vars[i];\n        var s = {};\n\n        for (var key in _this.vars) {\n          var cItem = _this.vars[key];\n\n          if (cItem.plugins) {\n            var plugin = new Plugins[cItem.array ? 'ArrayPlugin' : key](cItem.value, key);\n            plugin.target = target;\n            plugin.root = root;\n            plugin.parent = parent;\n            plugin.targetIndex = i;\n            plugin.tweenVars = vars;\n            plugin.index = _this.index;\n            plugin.startAt = startAt;\n            s[key] = plugin.getAnimStart();\n            cItem.plugins.push(plugin);\n          } else {\n            var _ref, _startAt$key;\n\n            var targetValue = (_ref = root.attr ? target.getAttribute(key) : vars[key] || target[key]) !== null && _ref !== void 0 ? _ref : getDefaultStart(key);\n            var startData = (_startAt$key = startAt[key]) !== null && _startAt$key !== void 0 ? _startAt$key : targetValue; // root.vars[i][key] ??\n\n            var isStartAt = _typeof(startData) === 'object' && 'vars' in startData && 'count' in startData;\n            var unit = isStartAt ? startData.unit : \"\".concat(startData).replace(/[^a-z|%]/g, '');\n            var varsUnit = cItem.unit;\n\n            if (unit && unit !== varsUnit) {\n              console.warn(\"Different units, start unit \".concat(unit, \", to value unit \").concat(varsUnit, \", remove start unit.\"));\n            }\n\n            s[key] = isStartAt ? getStartAtValue(targetValue, startData) : parseFloat(startData);\n          }\n        }\n\n        start.push(s);\n      }\n\n      _this.start = start;\n    };\n\n    this.overflowRatio = function (ratio) {\n      var r = ratio < 0 ? 0 : ratio;\n      var duration = _this.props.duration;\n      r = r > duration ? duration : r;\n      return r;\n    };\n\n    this.render = function (_ref2) {\n      var moment = _ref2.moment,\n          _ref2$fps = _ref2.fps,\n          fps = _ref2$fps === void 0 ? 0 : _ref2$fps,\n          silence = _ref2.silence,\n          render = _ref2.render;\n      var parent = _this.parent,\n          root = _this.root,\n          props = _this.props;\n      var targets = flatArray(root.targets);\n      var onChange = parent.onChange;\n      var _props$repeat = props.repeat,\n          repeat = _props$repeat === void 0 ? 0 : _props$repeat;\n      var _props$type = props.type,\n          type = _props$type === void 0 ? 'to' : _props$type,\n          _props$duration = props.duration,\n          duration = _props$duration === void 0 ? 450 : _props$duration,\n          _props$delay = props.delay,\n          delay = _props$delay === void 0 ? 0 : _props$delay,\n          _props$repeatDelay = props.repeatDelay,\n          repeatDelay = _props$repeatDelay === void 0 ? 0 : _props$repeatDelay,\n          yoyo = props.yoyo;\n      repeat = repeat === -1 ? Number.MAX_VALUE : repeat;\n      var ratio = moment - delay; // const totalTime = duration + delay;\n\n      var repeatNum = Math.floor(ratio / (duration + repeatDelay)) || 0;\n      repeatNum = repeatNum > repeat ? repeat : repeatNum;\n      repeatNum = repeatNum < 0 ? 0 : repeatNum;\n      ratio = ratio - (duration + repeatDelay) * repeatNum;\n      /**\n       * 反向播放 isFrom 与 yoyoReverse 的区别\n       * 反向播放: isFrom\n       * [---delay---][---isFrom duration---]\n       * yoyo\n       * [---duration---][---delay---]\n       * backwards\n       * 两个都为 true 时为 false;\n       */\n\n      var yoyoReverse = !!(yoyo && repeatNum % 2);\n      var isFrom = type === 'from';\n      var backwards = yoyoReverse && isFrom ? false : yoyoReverse || isFrom;\n      ratio = backwards ? duration - ratio : ratio;\n      var fromDelay = isFrom ? 0 : delay;\n      var r = backwards ? 1 : 0; // 0 进入时的注册\n\n      if (!_this.register && moment >= fromDelay) {\n        _this.onRegisterAnimate(); // 时间超出当前动画时间的处理\n\n\n        if (backwards && ratio <= 0 || !backwards && ratio >= duration && duration) {\n          // this.mode = 'onComplete';\n          _this.prevMoment = moment;\n          r = backwards ? 0 : 1;\n        }\n\n        _this.setRatioToVars(r); // 初始注册，改变外部 vars;\n\n\n        onChange({\n          index: _this.index,\n          vars: root.vars\n        });\n      }\n\n      if (_this.register && moment > delay - fps && moment < _this.totalTime + fps) {\n        ratio = _this.overflowRatio(ratio);\n        r = backwards ? 1 : 0;\n\n        if (moment >= _this.totalTime && _this.mode !== 'onComplete' && _this.prevMoment !== undefined || _this.prevMoment === undefined && moment >= _this.totalTime && duration) {\n          r = backwards ? 0 : 1;\n          _this.mode = 'onComplete';\n\n          if (_this.props.onComplete) {\n            _this.props.onComplete({\n              mode: _this.mode,\n              index: _this.index,\n              moment: ratio,\n              ratio: r,\n              targets: targets,\n              vars: flatArray(root.vars)\n            });\n          }\n        } else if (_this.prevMoment === undefined || moment <= 0 && moment > -fps && _this.mode !== 'onStart' && _this.prevMoment > moment) {\n          _this.mode = 'onStart';\n\n          if (_this.props.onStart) {\n            _this.props.onStart({\n              mode: _this.mode,\n              index: _this.index,\n              moment: ratio,\n              ratio: r,\n              targets: targets,\n              vars: flatArray(root.vars)\n            });\n          }\n        } else {\n          r = ratio && duration ? ratio / duration : 0;\n          _this.mode = 'onUpdate';\n\n          if (_this.props.onUpdate) {\n            _this.props.onUpdate({\n              mode: _this.mode,\n              index: _this.index,\n              moment: ratio,\n              ratio: r,\n              targets: targets,\n              vars: flatArray(root.vars)\n            });\n          }\n        }\n\n        if (repeat && repeatNum !== _this.repeatNum && moment && _this.mode === 'onUpdate') {\n          _this.mode = 'onRepeat';\n\n          if (_this.props.onRepeat) {\n            _this.props.onRepeat({\n              mode: _this.mode,\n              index: _this.index,\n              moment: ratio,\n              ratio: r,\n              targets: targets,\n              vars: flatArray(_this.root.vars)\n            });\n          }\n        }\n\n        _this.setRatioToVars(_this.getEaseToRatio(r, isFrom));\n\n        if (repeat) {\n          _this.repeatNum = repeatNum;\n        }\n\n        var cb = {\n          mode: _this.mode,\n          moment: ratio,\n          repeat: repeatNum,\n          ratio: r,\n          targets: root.targets,\n          vars: root.vars,\n          index: _this.index\n        };\n\n        if (silence) {\n          cb.silence = silence;\n        }\n\n        if (render) {\n          cb.render = render;\n        }\n\n        onChange(cb);\n        _this.prevMoment = moment;\n      }\n    };\n\n    this.item = _item; // delete item.appearTo;\n\n    this.startAt = _item.startAt || {};\n    Object.keys(this.startAt).forEach(function (c) {\n      _this.startAt[c] = _this.changeValueToVars(c, _this.startAt[c], true);\n    }); // delete item.startAt;\n\n    var _props = {};\n\n    for (var k in _item) {\n      var value = _item[k];\n\n      if (!(k in initAnimProps)) {\n        this.vars[k] = this.changeValueToVars(k, value);\n      } else {\n        _props[k] = value;\n      }\n    }\n\n    this.props = _objectSpread(_objectSpread({}, initAnimProps), _props);\n    this.setEase(this.props.ease);\n  }\n\n  _createClass(Element, [{\n    key: \"totalTime\",\n    get: // parentBackwards?: boolean;\n    function get() {\n      return this.getTotalTime();\n    }\n  }]);\n\n  return Element;\n}();\n\nexport { Element as default };"]},"metadata":{},"sourceType":"module"}