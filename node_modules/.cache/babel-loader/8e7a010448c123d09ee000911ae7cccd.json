{"ast":null,"code":"import _ from 'lodash';\nexport var mergeJsonPatch = function mergeJsonPatch(objectModified, object) {\n  if (!object) {\n    return objectModified;\n  }\n\n  var customizer = function customizer(objValue, srcValue) {\n    if (!objValue) {\n      return null;\n    }\n\n    if (_.isObject(objValue) && _.isObject(srcValue)) {\n      _.mergeWith(objValue, srcValue, customizer);\n    }\n\n    return objValue;\n  };\n\n  _.mergeWith(objectModified, object, customizer);\n\n  return objectModified;\n};\nexport var getIstioObject = function getIstioObject(istioObjectDetails) {\n  var istioObject;\n\n  if (istioObjectDetails) {\n    if (istioObjectDetails.gateway) {\n      istioObject = istioObjectDetails.gateway;\n    } else if (istioObjectDetails.virtualService) {\n      istioObject = istioObjectDetails.virtualService;\n    } else if (istioObjectDetails.destinationRule) {\n      istioObject = istioObjectDetails.destinationRule;\n    } else if (istioObjectDetails.serviceEntry) {\n      istioObject = istioObjectDetails.serviceEntry;\n    } else if (istioObjectDetails.workloadEntry) {\n      istioObject = istioObjectDetails.workloadEntry;\n    } else if (istioObjectDetails.workloadGroup) {\n      istioObject = istioObjectDetails.workloadGroup;\n    } else if (istioObjectDetails.envoyFilter) {\n      istioObject = istioObjectDetails.envoyFilter;\n    } else if (istioObjectDetails.authorizationPolicy) {\n      istioObject = istioObjectDetails.authorizationPolicy;\n    } else if (istioObjectDetails.peerAuthentication) {\n      istioObject = istioObjectDetails.peerAuthentication;\n    } else if (istioObjectDetails.requestAuthentication) {\n      istioObject = istioObjectDetails.requestAuthentication;\n    } else if (istioObjectDetails.sidecar) {\n      istioObject = istioObjectDetails.sidecar;\n    }\n  }\n\n  return istioObject;\n};\nvar nsRegexp = /^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[-a-z0-9]([-a-z0-9]*[a-z0-9])?)*$/;\nvar hostRegexp = /(?=^.{4,253}$)(^((?!-)(([a-zA-Z0-9-]{0,62}[a-zA-Z0-9])|\\*)\\.)+[a-zA-Z]{2,63}$)/;\nvar ipRegexp = /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))?$/;\nvar durationRegexp = /^[\\d]+\\.?[\\d]*(h|m|s|ms)$/; // Gateway hosts have namespace/dnsName with namespace optional\n\nexport var isGatewayHostValid = function isGatewayHostValid(gatewayHost) {\n  return isServerHostValid(gatewayHost, false);\n}; // Sidecar host have namespace/dnsName with both namespace/dnsName mandatory\n\nexport var isSidecarHostValid = function isSidecarHostValid(sidecarHost) {\n  return isServerHostValid(sidecarHost, true);\n}; // Used to check if Sidecar and Gateway host expressions are valid\n\nexport var isServerHostValid = function isServerHostValid(serverHost, nsMandatory) {\n  if (serverHost.length === 0) {\n    return false;\n  } // <namespace>/<host>\n\n\n  var parts = serverHost.split('/'); // More than one /\n\n  if (parts.length > 2) {\n    return false;\n  } // Force that namespace/dnsName are present\n\n\n  if (nsMandatory && parts.length < 2) {\n    return false;\n  } // parts[0] is a dns\n\n\n  var dnsValid = true;\n  var hostValid = true;\n  var dns = '';\n  var host = '';\n\n  if (parts.length === 2) {\n    dns = parts[0];\n    host = parts[1];\n\n    if (dns !== '.' && dns !== '*') {\n      dnsValid = parts[0].search(nsRegexp) === 0;\n    }\n  } else {\n    host = parts[0];\n  }\n\n  if (host !== '*') {\n    hostValid = host.search(hostRegexp) === 0;\n  }\n\n  return dnsValid && hostValid;\n};\nexport var isValidIp = function isValidIp(ip) {\n  return ipRegexp.test(ip);\n};\nexport var isValidUrl = function isValidUrl(url) {\n  try {\n    new URL(url);\n  } catch (_) {\n    return false;\n  }\n\n  return true;\n};\nexport var isValidDuration = function isValidDuration(duration) {\n  if (duration === '0ms' || duration === '0s' || duration === '0m' || duration === '0h') {\n    return false;\n  }\n\n  return durationRegexp.test(duration);\n};\nexport var isValidAbortStatusCode = function isValidAbortStatusCode(statusCode) {\n  return statusCode >= 100 && statusCode <= 599;\n};\nexport var isValidConnectionPool = function isValidConnectionPool(connectionPool) {\n  if (connectionPool.tcp) {\n    if (connectionPool.tcp.connectTimeout && !isValidDuration(connectionPool.tcp.connectTimeout)) {\n      return false;\n    }\n\n    if (connectionPool.tcp.tcpKeepalive) {\n      if (connectionPool.tcp.tcpKeepalive.interval && !isValidDuration(connectionPool.tcp.tcpKeepalive.interval)) {\n        return false;\n      }\n\n      if (connectionPool.tcp.tcpKeepalive.time && !isValidDuration(connectionPool.tcp.tcpKeepalive.time)) {\n        return false;\n      }\n    }\n  }\n\n  if (connectionPool.http) {\n    if (connectionPool.http.idleTimeout && !isValidDuration(connectionPool.http.idleTimeout)) {\n      return false;\n    }\n  }\n\n  return true;\n};\nexport var isValidOutlierDetection = function isValidOutlierDetection(outlierDetection) {\n  if (outlierDetection.interval && !isValidDuration(outlierDetection.interval)) {\n    return false;\n  }\n\n  if (outlierDetection.baseEjectionTime && !isValidDuration(outlierDetection.baseEjectionTime)) {\n    return false;\n  }\n\n  return true;\n};","map":{"version":3,"sources":["/root/GraduateProject/src/utils/IstioConfigUtils.ts"],"names":["_","mergeJsonPatch","objectModified","object","customizer","objValue","srcValue","isObject","mergeWith","getIstioObject","istioObjectDetails","istioObject","gateway","virtualService","destinationRule","serviceEntry","workloadEntry","workloadGroup","envoyFilter","authorizationPolicy","peerAuthentication","requestAuthentication","sidecar","nsRegexp","hostRegexp","ipRegexp","durationRegexp","isGatewayHostValid","gatewayHost","isServerHostValid","isSidecarHostValid","sidecarHost","serverHost","nsMandatory","length","parts","split","dnsValid","hostValid","dns","host","search","isValidIp","ip","test","isValidUrl","url","URL","isValidDuration","duration","isValidAbortStatusCode","statusCode","isValidConnectionPool","connectionPool","tcp","connectTimeout","tcpKeepalive","interval","time","http","idleTimeout","isValidOutlierDetection","outlierDetection","baseEjectionTime"],"mappings":"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","sourcesContent":["import { IstioConfigDetails } from '../types/IstioConfigDetails';\nimport { ConnectionPoolSettings, IstioObject, OutlierDetection } from '../types/IstioObjects';\nimport _ from 'lodash';\n\nexport const mergeJsonPatch = (objectModified: object, object?: object): object => {\n  if (!object) {\n    return objectModified;\n  }\n  const customizer = (objValue, srcValue) => {\n    if (!objValue) {\n      return null;\n    }\n    if (_.isObject(objValue) && _.isObject(srcValue)) {\n      _.mergeWith(objValue, srcValue, customizer);\n    }\n    return objValue;\n  };\n  _.mergeWith(objectModified, object, customizer);\n  return objectModified;\n};\n\nexport const getIstioObject = (istioObjectDetails?: IstioConfigDetails) => {\n  let istioObject: IstioObject | undefined;\n  if (istioObjectDetails) {\n    if (istioObjectDetails.gateway) {\n      istioObject = istioObjectDetails.gateway;\n    } else if (istioObjectDetails.virtualService) {\n      istioObject = istioObjectDetails.virtualService;\n    } else if (istioObjectDetails.destinationRule) {\n      istioObject = istioObjectDetails.destinationRule;\n    } else if (istioObjectDetails.serviceEntry) {\n      istioObject = istioObjectDetails.serviceEntry;\n    } else if (istioObjectDetails.workloadEntry) {\n      istioObject = istioObjectDetails.workloadEntry;\n    } else if (istioObjectDetails.workloadGroup) {\n      istioObject = istioObjectDetails.workloadGroup;\n    } else if (istioObjectDetails.envoyFilter) {\n      istioObject = istioObjectDetails.envoyFilter;\n    } else if (istioObjectDetails.authorizationPolicy) {\n      istioObject = istioObjectDetails.authorizationPolicy;\n    } else if (istioObjectDetails.peerAuthentication) {\n      istioObject = istioObjectDetails.peerAuthentication;\n    } else if (istioObjectDetails.requestAuthentication) {\n      istioObject = istioObjectDetails.requestAuthentication;\n    } else if (istioObjectDetails.sidecar) {\n      istioObject = istioObjectDetails.sidecar;\n    }\n  }\n  return istioObject;\n};\n\nconst nsRegexp = /^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[-a-z0-9]([-a-z0-9]*[a-z0-9])?)*$/;\nconst hostRegexp = /(?=^.{4,253}$)(^((?!-)(([a-zA-Z0-9-]{0,62}[a-zA-Z0-9])|\\*)\\.)+[a-zA-Z]{2,63}$)/;\nconst ipRegexp = /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))?$/;\nconst durationRegexp = /^[\\d]+\\.?[\\d]*(h|m|s|ms)$/;\n\n// Gateway hosts have namespace/dnsName with namespace optional\nexport const isGatewayHostValid = (gatewayHost: string): boolean => {\n  return isServerHostValid(gatewayHost, false);\n};\n\n// Sidecar host have namespace/dnsName with both namespace/dnsName mandatory\nexport const isSidecarHostValid = (sidecarHost: string): boolean => {\n  return isServerHostValid(sidecarHost, true);\n};\n\n// Used to check if Sidecar and Gateway host expressions are valid\nexport const isServerHostValid = (serverHost: string, nsMandatory: boolean): boolean => {\n  if (serverHost.length === 0) {\n    return false;\n  }\n  // <namespace>/<host>\n  const parts = serverHost.split('/');\n  // More than one /\n  if (parts.length > 2) {\n    return false;\n  }\n  // Force that namespace/dnsName are present\n  if (nsMandatory && parts.length < 2) {\n    return false;\n  }\n\n  // parts[0] is a dns\n  let dnsValid = true;\n  let hostValid = true;\n  let dns = '';\n  let host = '';\n  if (parts.length === 2) {\n    dns = parts[0];\n    host = parts[1];\n\n    if (dns !== '.' && dns !== '*') {\n      dnsValid = parts[0].search(nsRegexp) === 0;\n    }\n  } else {\n    host = parts[0];\n  }\n\n  if (host !== '*') {\n    hostValid = host.search(hostRegexp) === 0;\n  }\n  return dnsValid && hostValid;\n};\n\nexport const isValidIp = (ip: string): boolean => {\n  return ipRegexp.test(ip);\n};\n\nexport const isValidUrl = (url: string): boolean => {\n  try {\n    new URL(url);\n  } catch (_) {\n    return false;\n  }\n  return true;\n};\n\nexport const isValidDuration = (duration: string): boolean => {\n  if (duration === '0ms' || duration === '0s' || duration === '0m' || duration === '0h') {\n    return false;\n  }\n  return durationRegexp.test(duration);\n};\n\nexport const isValidAbortStatusCode = (statusCode: number): boolean => {\n  return statusCode >= 100 && statusCode <= 599;\n};\n\nexport const isValidConnectionPool = (connectionPool: ConnectionPoolSettings): boolean => {\n  if (connectionPool.tcp) {\n    if (connectionPool.tcp.connectTimeout && !isValidDuration(connectionPool.tcp.connectTimeout)) {\n      return false;\n    }\n    if (connectionPool.tcp.tcpKeepalive) {\n      if (connectionPool.tcp.tcpKeepalive.interval && !isValidDuration(connectionPool.tcp.tcpKeepalive.interval)) {\n        return false;\n      }\n      if (connectionPool.tcp.tcpKeepalive.time && !isValidDuration(connectionPool.tcp.tcpKeepalive.time)) {\n        return false;\n      }\n    }\n  }\n  if (connectionPool.http) {\n    if (connectionPool.http.idleTimeout && !isValidDuration(connectionPool.http.idleTimeout)) {\n      return false;\n    }\n  }\n  return true;\n};\n\nexport const isValidOutlierDetection = (outlierDetection: OutlierDetection): boolean => {\n  if (outlierDetection.interval && !isValidDuration(outlierDetection.interval)) {\n    return false;\n  }\n  if (outlierDetection.baseEjectionTime && !isValidDuration(outlierDetection.baseEjectionTime)) {\n    return false;\n  }\n  return true;\n};\n"]},"metadata":{},"sourceType":"module"}