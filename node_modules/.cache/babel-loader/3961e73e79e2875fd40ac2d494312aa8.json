{"ast":null,"code":"import _classCallCheck from\"/root/GraduateProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/root/GraduateProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/root/GraduateProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/root/GraduateProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import*as React from'react';import*as API from'../../services/Api';import*as AlertUtils from'../../utils/AlertUtils';import{Status}from'../../types/IstioStatus';import{MessageType}from'../../types/MessageCenter';import{istioStatusSelector,lastRefreshAtSelector,namespaceItemsSelector}from'../../store/Selectors';import{bindActionCreators}from'redux';import{IstioStatusActions}from'../../actions/IstioStatusActions';import{connect}from'react-redux';import{Tooltip,TooltipPosition}from'@patternfly/react-core';import IstioStatusList from'./IstioStatusList';import{PFColors}from'../Pf/PfColors';import'./IstioStatus.css';import{ResourcesFullIcon}from'@patternfly/react-icons';import NamespaceThunkActions from'../../actions/NamespaceThunkActions';var ValidToColor={'true-true-true':PFColors.Danger,'true-true-false':PFColors.Danger,'true-false-true':PFColors.Danger,'true-false-false':PFColors.Danger,'false-true-true':PFColors.Warning,'false-true-false':PFColors.Warning,'false-false-true':PFColors.Info,'false-false-false':PFColors.Success};export var IstioStatus=/*#__PURE__*/function(_React$Component){_inherits(IstioStatus,_React$Component);var _super=_createSuper(IstioStatus);function IstioStatus(){var _this;_classCallCheck(this,IstioStatus);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.fetchStatus=function(){API.getIstioStatus().then(function(response){return _this.props.setIstioStatus(response.data);}).catch(function(error){// User without namespaces can't have access to mTLS information. Reduce severity to info.\nvar informative=_this.props.namespaces&&_this.props.namespaces.length<1;if(informative){AlertUtils.addError('Istio deployment status disabled.',error,'default',MessageType.INFO);}else{AlertUtils.addError('Error fetching Istio deployment status.',error,'default',MessageType.ERROR);}});};_this.tooltipContent=function(){return/*#__PURE__*/React.createElement(IstioStatusList,{status:_this.props.status});};_this.tooltipColor=function(){var coreUnhealthy=false;var addonUnhealthy=false;var notReady=false;Object.keys(_this.props.status||{}).forEach(function(compKey){var _this$props$status$co=_this.props.status[compKey],status=_this$props$status$co.status,is_core=_this$props$status$co.is_core;var isNotReady=status===Status.NotReady;var isUnhealthy=status!==Status.Healthy&&!isNotReady;if(is_core){coreUnhealthy=coreUnhealthy||isUnhealthy;}else{addonUnhealthy=addonUnhealthy||isUnhealthy;}notReady=notReady||isNotReady;});return ValidToColor[\"\".concat(coreUnhealthy,\"-\").concat(addonUnhealthy,\"-\").concat(notReady)];};_this.healthyComponents=function(){return _this.props.status.reduce(function(healthy,compStatus){return healthy&&compStatus.status===Status.Healthy;},true);};return _this;}_createClass(IstioStatus,[{key:\"componentDidMount\",value:function componentDidMount(){this.props.refreshNamespaces();this.fetchStatus();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(this.props.lastRefreshAt!==prevProps.lastRefreshAt){this.fetchStatus();}}},{key:\"render\",value:function render(){if(!this.healthyComponents()){return/*#__PURE__*/React.createElement(Tooltip,{position:TooltipPosition.left,enableFlip:true,content:this.tooltipContent(),maxWidth:'25rem'},/*#__PURE__*/React.createElement(ResourcesFullIcon,{color:this.tooltipColor(),style:{verticalAlign:'-0.3em',marginRight:8}}));}return null;}}]);return IstioStatus;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{status:istioStatusSelector(state),lastRefreshAt:lastRefreshAtSelector(state),namespaces:namespaceItemsSelector(state)};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{setIstioStatus:bindActionCreators(IstioStatusActions.setinfo,dispatch),refreshNamespaces:function refreshNamespaces(){dispatch(NamespaceThunkActions.fetchNamespacesIfNeeded());}};};var IstioStatusConnected=connect(mapStateToProps,mapDispatchToProps)(IstioStatus);export default IstioStatusConnected;","map":null,"metadata":{},"sourceType":"module"}