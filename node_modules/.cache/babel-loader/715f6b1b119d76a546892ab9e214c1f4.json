{"ast":null,"code":"import _classCallCheck from \"/root/kiali-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/root/kiali-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/root/kiali-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/root/kiali-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"/root/kiali-ui/src/pages/Graph/GraphToolbar/GraphToolbar.tsx\";\nimport * as React from 'react';\nimport { Button, ButtonVariant, Toolbar, ToolbarGroup, Tooltip, TooltipPosition } from '@patternfly/react-core';\nimport { style } from 'typestyle';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { activeNamespacesSelector, edgeLabelsSelector, graphTypeSelector, showIdleNodesSelector, replayActiveSelector, trafficRatesSelector } from '../../../store/Selectors';\nimport { GraphToolbarActions } from '../../../actions/GraphToolbarActions';\nimport GraphFindContainer from './GraphFind';\nimport GraphSettingsContainer from './GraphSettings';\nimport history, { HistoryManager, URLParam } from '../../../app/History';\nimport { namespacesFromString, namespacesToString } from '../../../types/Namespace';\nimport { NamespaceActions } from '../../../actions/NamespaceAction';\nimport { GraphActions } from '../../../actions/GraphActions';\nimport { GraphTourStops } from 'pages/Graph/GraphHelpTour';\nimport TourStopContainer from 'components/Tour/TourStop';\nimport { KialiIcon, defaultIconStyle } from 'config/KialiIcon';\nimport ReplayContainer from 'components/Time/Replay';\nimport { UserSettingsActions } from 'actions/UserSettingsActions';\nimport GraphSecondaryMasthead from './GraphSecondaryMasthead';\nimport { CyNode } from 'components/CytoscapeGraph/CytoscapeGraphUtils';\nimport { INITIAL_USER_SETTINGS_STATE } from 'reducers/UserSettingsState';\nimport GraphResetContainer from './GraphReset';\nvar toolbarStyle = style({\n  marginBottom: '20px',\n  marginTop: '20px'\n});\nvar rightToolbarStyle = style({\n  marginLeft: 'auto'\n});\nexport var GraphToolbar = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(GraphToolbar, _React$PureComponent);\n\n  var _super = _createSuper(GraphToolbar);\n\n  function GraphToolbar(props) {\n    var _this;\n\n    _classCallCheck(this, GraphToolbar);\n\n    _this = _super.call(this, props); // Let URL override current redux state at construction time. Update URL as needed.\n\n    _this.handleRefresh = function () {\n      if (_this.props.onRefresh) {\n        _this.props.onRefresh();\n      }\n    };\n\n    _this.handleNamespaceReturn = function () {\n      if (!_this.props.summaryData || _this.props.summaryData.summaryType !== 'node' && _this.props.summaryData.summaryType !== 'box') {\n        history.push(\"/graph/namespaces\");\n        return;\n      }\n\n      var selector = \"node[id = \\\"\".concat(_this.props.summaryData.summaryTarget.data(CyNode.id), \"\\\"]\");\n\n      _this.props.setNode(undefined);\n\n      history.push(\"/graph/namespaces?focusSelector=\".concat(encodeURI(selector)));\n    };\n\n    var urlParams = new URLSearchParams(history.location.search);\n    var urlEdgeLabels = HistoryManager.getParam(URLParam.GRAPH_EDGE_LABEL, urlParams);\n\n    if (!!urlEdgeLabels) {\n      if (urlEdgeLabels !== props.edgeLabels.join(',')) {\n        props.setEdgeLabels(urlEdgeLabels.split(','));\n      }\n    } else if (props.setEdgeLabels.length > 0) {\n      HistoryManager.setParam(URLParam.GRAPH_EDGE_LABEL, props.edgeLabels.join(','));\n    }\n\n    var urlReplayActive = HistoryManager.getBooleanParam(URLParam.GRAPH_REPLAY_ACTIVE);\n\n    if (urlReplayActive !== undefined) {\n      if (urlReplayActive !== _this.props.replayActive) {\n        _this.props.toggleReplayActive();\n      }\n    } else if (_this.props.replayActive !== INITIAL_USER_SETTINGS_STATE.replayActive) {\n      HistoryManager.setParam(URLParam.GRAPH_REPLAY_ACTIVE, String(_this.props.replayActive));\n    }\n\n    var urlGraphTraffic = HistoryManager.getParam(URLParam.GRAPH_TRAFFIC, urlParams);\n\n    if (!!urlGraphTraffic) {\n      if (urlGraphTraffic !== props.trafficRates.join(',')) {\n        props.setTrafficRates(urlGraphTraffic.split(','));\n      }\n    } else if (props.trafficRates.length > 0) {\n      HistoryManager.setParam(URLParam.GRAPH_TRAFFIC, props.trafficRates.join(','));\n    }\n\n    var urlGraphType = HistoryManager.getParam(URLParam.GRAPH_TYPE, urlParams);\n\n    if (!!urlGraphType) {\n      if (urlGraphType !== props.graphType) {\n        props.setGraphType(urlGraphType);\n      }\n    } else {\n      HistoryManager.setParam(URLParam.GRAPH_TYPE, String(_this.props.graphType));\n    }\n\n    var urlNamespaces = HistoryManager.getParam(URLParam.NAMESPACES, urlParams);\n\n    if (!!urlNamespaces) {\n      if (urlNamespaces !== namespacesToString(props.activeNamespaces)) {\n        props.setActiveNamespaces(namespacesFromString(urlNamespaces));\n      }\n    } else if (props.activeNamespaces.length > 0) {\n      HistoryManager.setParam(URLParam.NAMESPACES, namespacesToString(props.activeNamespaces));\n    }\n\n    return _this;\n  }\n\n  _createClass(GraphToolbar, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      var _this$props$edgeLabel, _this$props$activeNam, _this$props$trafficRa;\n\n      // ensure redux state and URL are aligned\n      if (((_this$props$edgeLabel = this.props.edgeLabels) === null || _this$props$edgeLabel === void 0 ? void 0 : _this$props$edgeLabel.length) === 0) {\n        HistoryManager.deleteParam(URLParam.GRAPH_EDGE_LABEL, true);\n      } else {\n        HistoryManager.setParam(URLParam.GRAPH_EDGE_LABEL, String(this.props.edgeLabels));\n      }\n\n      if (((_this$props$activeNam = this.props.activeNamespaces) === null || _this$props$activeNam === void 0 ? void 0 : _this$props$activeNam.length) === 0) {\n        HistoryManager.deleteParam(URLParam.NAMESPACES, true);\n      } else {\n        HistoryManager.setParam(URLParam.NAMESPACES, namespacesToString(this.props.activeNamespaces));\n      }\n\n      if (this.props.replayActive === INITIAL_USER_SETTINGS_STATE.replayActive) {\n        HistoryManager.deleteParam(URLParam.GRAPH_REPLAY_ACTIVE, true);\n      } else {\n        HistoryManager.setParam(URLParam.GRAPH_REPLAY_ACTIVE, String(this.props.replayActive));\n      }\n\n      if (((_this$props$trafficRa = this.props.trafficRates) === null || _this$props$trafficRa === void 0 ? void 0 : _this$props$trafficRa.length) === 0) {\n        HistoryManager.deleteParam(URLParam.GRAPH_TRAFFIC, true);\n      } else {\n        HistoryManager.setParam(URLParam.GRAPH_TRAFFIC, String(this.props.trafficRates));\n      }\n\n      HistoryManager.setParam(URLParam.GRAPH_TYPE, String(this.props.graphType));\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      // If replay was left active then turn it off\n      if (this.props.replayActive) {\n        this.props.toggleReplayActive();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(GraphSecondaryMasthead, {\n        disabled: this.props.disabled,\n        graphType: this.props.graphType,\n        isNodeGraph: !!this.props.node,\n        onToggleHelp: this.props.onToggleHelp,\n        onGraphTypeChange: this.props.setGraphType,\n        onHandleRefresh: this.handleRefresh,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(Toolbar, {\n        className: toolbarStyle,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          display: 'flex'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 11\n        }\n      }, this.props.node && /*#__PURE__*/React.createElement(Tooltip, {\n        key: 'graph-tour-help-ot',\n        position: TooltipPosition.right,\n        content: 'Back to full graph',\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        variant: ButtonVariant.link,\n        onClick: this.handleNamespaceReturn,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(KialiIcon.Back, {\n        className: defaultIconStyle,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 19\n        }\n      }))), /*#__PURE__*/React.createElement(TourStopContainer, {\n        info: GraphTourStops.Display,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(GraphSettingsContainer, {\n        graphType: this.props.graphType,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 15\n        }\n      }))), /*#__PURE__*/React.createElement(GraphFindContainer, {\n        cy: this.props.cy,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(TourStopContainer, {\n        info: GraphTourStops.Shortcuts,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(ToolbarGroup, {\n        className: rightToolbarStyle,\n        \"aria-label\": \"graph_refresh_toolbar\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Tooltip, {\n        key: 'graph-tour-help-ot',\n        position: TooltipPosition.right,\n        content: \"Shortcuts and tips...\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        className: rightToolbarStyle,\n        variant: \"link\",\n        style: {\n          paddingLeft: '6px',\n          paddingRight: '0px'\n        },\n        onClick: this.props.onToggleHelp,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(KialiIcon.Help, {\n        className: defaultIconStyle,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 19\n        }\n      }))), /*#__PURE__*/React.createElement(GraphResetContainer, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 15\n        }\n      })))), this.props.replayActive && /*#__PURE__*/React.createElement(ReplayContainer, {\n        id: \"time-range-replay\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 37\n        }\n      }));\n    }\n  }]);\n\n  return GraphToolbar;\n}(React.PureComponent);\nGraphToolbar.contextTypes = {\n  router: function router() {\n    return null;\n  }\n};\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    activeNamespaces: activeNamespacesSelector(state),\n    edgeLabels: edgeLabelsSelector(state),\n    graphType: graphTypeSelector(state),\n    node: state.graph.node,\n    replayActive: replayActiveSelector(state),\n    showIdleNodes: showIdleNodesSelector(state),\n    summaryData: state.graph.summaryData,\n    trafficRates: trafficRatesSelector(state)\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    setActiveNamespaces: bindActionCreators(NamespaceActions.setActiveNamespaces, dispatch),\n    setEdgeLabels: bindActionCreators(GraphToolbarActions.setEdgeLabels, dispatch),\n    setGraphType: bindActionCreators(GraphToolbarActions.setGraphType, dispatch),\n    setIdleNodes: bindActionCreators(GraphToolbarActions.setIdleNodes, dispatch),\n    setNode: bindActionCreators(GraphActions.setNode, dispatch),\n    setTrafficRates: bindActionCreators(GraphToolbarActions.setTrafficRates, dispatch),\n    toggleReplayActive: bindActionCreators(UserSettingsActions.toggleReplayActive, dispatch)\n  };\n};\n\nvar GraphToolbarContainer = connect(mapStateToProps, mapDispatchToProps)(GraphToolbar);\nexport default GraphToolbarContainer;","map":{"version":3,"sources":["/root/kiali-ui/src/pages/Graph/GraphToolbar/GraphToolbar.tsx"],"names":["React","Button","ButtonVariant","Toolbar","ToolbarGroup","Tooltip","TooltipPosition","style","connect","bindActionCreators","activeNamespacesSelector","edgeLabelsSelector","graphTypeSelector","showIdleNodesSelector","replayActiveSelector","trafficRatesSelector","GraphToolbarActions","GraphFindContainer","GraphSettingsContainer","history","HistoryManager","URLParam","namespacesFromString","namespacesToString","NamespaceActions","GraphActions","GraphTourStops","TourStopContainer","KialiIcon","defaultIconStyle","ReplayContainer","UserSettingsActions","GraphSecondaryMasthead","CyNode","INITIAL_USER_SETTINGS_STATE","GraphResetContainer","toolbarStyle","marginBottom","marginTop","rightToolbarStyle","marginLeft","GraphToolbar","props","handleRefresh","onRefresh","handleNamespaceReturn","summaryData","summaryType","push","selector","summaryTarget","data","id","setNode","undefined","encodeURI","urlParams","URLSearchParams","location","search","urlEdgeLabels","getParam","GRAPH_EDGE_LABEL","edgeLabels","join","setEdgeLabels","split","length","setParam","urlReplayActive","getBooleanParam","GRAPH_REPLAY_ACTIVE","replayActive","toggleReplayActive","String","urlGraphTraffic","GRAPH_TRAFFIC","trafficRates","setTrafficRates","urlGraphType","GRAPH_TYPE","graphType","setGraphType","urlNamespaces","NAMESPACES","activeNamespaces","setActiveNamespaces","deleteParam","disabled","node","onToggleHelp","display","right","link","Display","cy","Shortcuts","paddingLeft","paddingRight","PureComponent","contextTypes","router","mapStateToProps","state","graph","showIdleNodes","mapDispatchToProps","dispatch","setIdleNodes","GraphToolbarContainer"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { Button, ButtonVariant, Toolbar, ToolbarGroup, Tooltip, TooltipPosition } from '@patternfly/react-core';\nimport { style } from 'typestyle';\nimport { connect } from 'react-redux';\nimport { ThunkDispatch } from 'redux-thunk';\nimport { bindActionCreators } from 'redux';\nimport { KialiAppState } from '../../../store/Store';\nimport {\n  activeNamespacesSelector,\n  edgeLabelsSelector,\n  graphTypeSelector,\n  showIdleNodesSelector,\n  replayActiveSelector,\n  trafficRatesSelector\n} from '../../../store/Selectors';\nimport { GraphToolbarActions } from '../../../actions/GraphToolbarActions';\nimport { GraphType, NodeParamsType, EdgeLabelMode, SummaryData, TrafficRate } from '../../../types/Graph';\nimport GraphFindContainer from './GraphFind';\nimport GraphSettingsContainer from './GraphSettings';\nimport history, { HistoryManager, URLParam } from '../../../app/History';\nimport Namespace, { namespacesFromString, namespacesToString } from '../../../types/Namespace';\nimport { NamespaceActions } from '../../../actions/NamespaceAction';\nimport { GraphActions } from '../../../actions/GraphActions';\nimport { KialiAppAction } from '../../../actions/KialiAppAction';\nimport { GraphTourStops } from 'pages/Graph/GraphHelpTour';\nimport TourStopContainer from 'components/Tour/TourStop';\nimport { KialiIcon, defaultIconStyle } from 'config/KialiIcon';\nimport ReplayContainer from 'components/Time/Replay';\nimport { UserSettingsActions } from 'actions/UserSettingsActions';\nimport GraphSecondaryMasthead from './GraphSecondaryMasthead';\nimport { CyNode } from 'components/CytoscapeGraph/CytoscapeGraphUtils';\nimport { INITIAL_USER_SETTINGS_STATE } from 'reducers/UserSettingsState';\nimport GraphResetContainer from './GraphReset';\n\ntype ReduxProps = {\n  activeNamespaces: Namespace[];\n  edgeLabels: EdgeLabelMode[];\n  graphType: GraphType;\n  node?: NodeParamsType;\n  replayActive: boolean;\n  showIdleNodes: boolean;\n  summaryData: SummaryData | null;\n  trafficRates: TrafficRate[];\n\n  setActiveNamespaces: (activeNamespaces: Namespace[]) => void;\n  setEdgeLabels: (edgeLabels: EdgeLabelMode[]) => void;\n  setGraphType: (graphType: GraphType) => void;\n  setIdleNodes: (idleNodes: boolean) => void;\n  setNode: (node?: NodeParamsType) => void;\n  setTrafficRates: (rates: TrafficRate[]) => void;\n  toggleReplayActive: () => void;\n};\n\ntype GraphToolbarProps = ReduxProps & {\n  cy: any;\n  disabled: boolean;\n  onToggleHelp: () => void;\n  onRefresh?: () => void;\n};\n\nconst toolbarStyle = style({\n  marginBottom: '20px',\n  marginTop: '20px'\n});\n\nconst rightToolbarStyle = style({\n  marginLeft: 'auto'\n});\n\nexport class GraphToolbar extends React.PureComponent<GraphToolbarProps> {\n  static contextTypes = {\n    router: () => null\n  };\n\n  constructor(props: GraphToolbarProps) {\n    super(props);\n    // Let URL override current redux state at construction time. Update URL as needed.\n    const urlParams = new URLSearchParams(history.location.search);\n\n    const urlEdgeLabels = HistoryManager.getParam(URLParam.GRAPH_EDGE_LABEL, urlParams);\n    if (!!urlEdgeLabels) {\n      if (urlEdgeLabels !== props.edgeLabels.join(',')) {\n        props.setEdgeLabels(urlEdgeLabels.split(',') as EdgeLabelMode[]);\n      }\n    } else if (props.setEdgeLabels.length > 0) {\n      HistoryManager.setParam(URLParam.GRAPH_EDGE_LABEL, props.edgeLabels.join(','));\n    }\n\n    const urlReplayActive = HistoryManager.getBooleanParam(URLParam.GRAPH_REPLAY_ACTIVE);\n    if (urlReplayActive !== undefined) {\n      if (urlReplayActive !== this.props.replayActive) {\n        this.props.toggleReplayActive();\n      }\n    } else if (this.props.replayActive !== INITIAL_USER_SETTINGS_STATE.replayActive) {\n      HistoryManager.setParam(URLParam.GRAPH_REPLAY_ACTIVE, String(this.props.replayActive));\n    }\n\n    const urlGraphTraffic = HistoryManager.getParam(URLParam.GRAPH_TRAFFIC, urlParams);\n    if (!!urlGraphTraffic) {\n      if (urlGraphTraffic !== props.trafficRates.join(',')) {\n        props.setTrafficRates(urlGraphTraffic.split(',') as TrafficRate[]);\n      }\n    } else if (props.trafficRates.length > 0) {\n      HistoryManager.setParam(URLParam.GRAPH_TRAFFIC, props.trafficRates.join(','));\n    }\n\n    const urlGraphType = HistoryManager.getParam(URLParam.GRAPH_TYPE, urlParams) as GraphType;\n    if (!!urlGraphType) {\n      if (urlGraphType !== props.graphType) {\n        props.setGraphType(urlGraphType);\n      }\n    } else {\n      HistoryManager.setParam(URLParam.GRAPH_TYPE, String(this.props.graphType));\n    }\n\n    const urlNamespaces = HistoryManager.getParam(URLParam.NAMESPACES, urlParams);\n    if (!!urlNamespaces) {\n      if (urlNamespaces !== namespacesToString(props.activeNamespaces)) {\n        props.setActiveNamespaces(namespacesFromString(urlNamespaces));\n      }\n    } else if (props.activeNamespaces.length > 0) {\n      HistoryManager.setParam(URLParam.NAMESPACES, namespacesToString(props.activeNamespaces));\n    }\n  }\n\n  componentDidUpdate() {\n    // ensure redux state and URL are aligned\n    if (this.props.edgeLabels?.length === 0) {\n      HistoryManager.deleteParam(URLParam.GRAPH_EDGE_LABEL, true);\n    } else {\n      HistoryManager.setParam(URLParam.GRAPH_EDGE_LABEL, String(this.props.edgeLabels));\n    }\n\n    if (this.props.activeNamespaces?.length === 0) {\n      HistoryManager.deleteParam(URLParam.NAMESPACES, true);\n    } else {\n      HistoryManager.setParam(URLParam.NAMESPACES, namespacesToString(this.props.activeNamespaces));\n    }\n\n    if (this.props.replayActive === INITIAL_USER_SETTINGS_STATE.replayActive) {\n      HistoryManager.deleteParam(URLParam.GRAPH_REPLAY_ACTIVE, true);\n    } else {\n      HistoryManager.setParam(URLParam.GRAPH_REPLAY_ACTIVE, String(this.props.replayActive));\n    }\n\n    if (this.props.trafficRates?.length === 0) {\n      HistoryManager.deleteParam(URLParam.GRAPH_TRAFFIC, true);\n    } else {\n      HistoryManager.setParam(URLParam.GRAPH_TRAFFIC, String(this.props.trafficRates));\n    }\n\n    HistoryManager.setParam(URLParam.GRAPH_TYPE, String(this.props.graphType));\n  }\n\n  componentWillUnmount() {\n    // If replay was left active then turn it off\n    if (this.props.replayActive) {\n      this.props.toggleReplayActive();\n    }\n  }\n\n  render() {\n    return (\n      <>\n        <GraphSecondaryMasthead\n          disabled={this.props.disabled}\n          graphType={this.props.graphType}\n          isNodeGraph={!!this.props.node}\n          onToggleHelp={this.props.onToggleHelp}\n          onGraphTypeChange={this.props.setGraphType}\n          onHandleRefresh={this.handleRefresh}\n        />\n        <Toolbar className={toolbarStyle}>\n          <div style={{ display: 'flex' }}>\n            {this.props.node && (\n              <Tooltip key={'graph-tour-help-ot'} position={TooltipPosition.right} content={'Back to full graph'}>\n                <Button variant={ButtonVariant.link} onClick={this.handleNamespaceReturn}>\n                  <KialiIcon.Back className={defaultIconStyle} />\n                </Button>\n              </Tooltip>\n            )}\n            <TourStopContainer info={GraphTourStops.Display}>\n              <GraphSettingsContainer graphType={this.props.graphType} />\n            </TourStopContainer>\n          </div>\n          <GraphFindContainer cy={this.props.cy} />\n\n          <TourStopContainer info={GraphTourStops.Shortcuts}>\n            <ToolbarGroup className={rightToolbarStyle} aria-label=\"graph_refresh_toolbar\">\n              <Tooltip key={'graph-tour-help-ot'} position={TooltipPosition.right} content=\"Shortcuts and tips...\">\n                <Button\n                  className={rightToolbarStyle}\n                  variant=\"link\"\n                  style={{ paddingLeft: '6px', paddingRight: '0px' }}\n                  onClick={this.props.onToggleHelp}\n                >\n                  <KialiIcon.Help className={defaultIconStyle} />\n                </Button>\n              </Tooltip>\n              <GraphResetContainer />\n            </ToolbarGroup>\n          </TourStopContainer>\n        </Toolbar>\n        {this.props.replayActive && <ReplayContainer id=\"time-range-replay\" />}\n      </>\n    );\n  }\n\n  private handleRefresh = () => {\n    if (this.props.onRefresh) {\n      this.props.onRefresh();\n    }\n  };\n\n  private handleNamespaceReturn = () => {\n    if (\n      !this.props.summaryData ||\n      (this.props.summaryData.summaryType !== 'node' && this.props.summaryData.summaryType !== 'box')\n    ) {\n      history.push(`/graph/namespaces`);\n      return;\n    }\n\n    const selector = `node[id = \"${this.props.summaryData!.summaryTarget.data(CyNode.id)}\"]`;\n    this.props.setNode(undefined);\n    history.push(`/graph/namespaces?focusSelector=${encodeURI(selector)}`);\n  };\n}\n\nconst mapStateToProps = (state: KialiAppState) => ({\n  activeNamespaces: activeNamespacesSelector(state),\n  edgeLabels: edgeLabelsSelector(state),\n  graphType: graphTypeSelector(state),\n  node: state.graph.node,\n  replayActive: replayActiveSelector(state),\n  showIdleNodes: showIdleNodesSelector(state),\n  summaryData: state.graph.summaryData,\n  trafficRates: trafficRatesSelector(state)\n});\n\nconst mapDispatchToProps = (dispatch: ThunkDispatch<KialiAppState, void, KialiAppAction>) => {\n  return {\n    setActiveNamespaces: bindActionCreators(NamespaceActions.setActiveNamespaces, dispatch),\n    setEdgeLabels: bindActionCreators(GraphToolbarActions.setEdgeLabels, dispatch),\n    setGraphType: bindActionCreators(GraphToolbarActions.setGraphType, dispatch),\n    setIdleNodes: bindActionCreators(GraphToolbarActions.setIdleNodes, dispatch),\n    setNode: bindActionCreators(GraphActions.setNode, dispatch),\n    setTrafficRates: bindActionCreators(GraphToolbarActions.setTrafficRates, dispatch),\n    toggleReplayActive: bindActionCreators(UserSettingsActions.toggleReplayActive, dispatch)\n  };\n};\n\nconst GraphToolbarContainer = connect(mapStateToProps, mapDispatchToProps)(GraphToolbar);\n\nexport default GraphToolbarContainer;\n"]},"metadata":{},"sourceType":"module"}